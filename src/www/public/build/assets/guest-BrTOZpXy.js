import{j as t,r as n,m as C,L as _}from"./app-Ce-QGPGl.js";import{C as w,a as x}from"./card-CZ9LVLad.js";import{c as L}from"./utils-jAU0Cazi.js";import{I as F}from"./input-CNkg4OnG.js";function h({children:r,className:u,...d}){return t.jsx(w,{className:L("bg-gradient-to-r from-blue-500 to-purple-600 text-white cursor-pointer hover:scale-105 transition-transform border-none",u),...d,children:r})}function V(){const[r,u]=n.useState(null),d=n.useRef(null),[p,f]=n.useState("language"),[E,j]=n.useState([]),v=n.useRef(null),[R,l]=n.useState(!1),c=n.useRef(null),{data:a,setData:i,post:N}=C({language:"",service_id:0,service_name:"",code:"",vip_number:null}),T=async e=>{try{const m=await(await fetch(`/service-list?language=${e}`)).json();j(m)}catch(s){console.error("Failed to fetch services",s)}};n.useEffect(()=>{T("en")},[]);const y=e=>{i("language",e),f("service")},b=e=>{const s={language:a.language,service_id:e.id,code:e.code,service_name:e.name};r&&(s.vip_number=r),i(s)};n.useEffect(()=>{const s=async()=>{try{const o=await(await fetch("/socket-ip-and-port")).json();if(!(o!=null&&o.ip)||!(o!=null&&o.port)){l(!0),c.current=setTimeout(s,5e3);return}l(!1);const g=new WebSocket(`ws://${o.ip}:${o.port}`);v.current=g,g.addEventListener("open",()=>{console.log("Connected to WS server"),l(!1),c.current&&(clearTimeout(c.current),c.current=null)});const S=()=>{l(!0),c.current=setTimeout(s,5e3)};g.addEventListener("close",S),g.addEventListener("error",S)}catch(m){l(!0),c.current=setTimeout(s,5e3),console.error("Failed to fetch services",m)}};return s(),()=>{c.current&&clearTimeout(c.current)}},[]),n.useEffect(()=>{a.service_id&&(console.log("ðŸš€ ~ Welcome ~ data:",a),N("/tokens",{onSuccess:()=>{f("thankyou");const e=v.current;if(e&&e.readyState===WebSocket.OPEN){const s={event:"new-ticket"};e.send(JSON.stringify(s))}else console.warn("WebSocket is not open.");u(null),f("language"),i({language:"",service_id:0,service_name:"",code:"",vip_number:null})},onFinish:()=>{},onError:e=>{console.error("Form submission failed",e)}}))},[a]),n.useEffect(()=>{if(r&&r!==d.current){const e=setTimeout(()=>{console.log("ðŸš€ Updating code with QR value:",r),i(s=>({...s,vip_number:r})),d.current=r},1e3);return()=>clearTimeout(e)}},[r,i]);const k=async e=>{const s=e.target.value;u(s),console.log("âœ… QR Code set:",s)};return t.jsxs("div",{className:"relative flex min-h-screen flex-col items-center justify-center bg-[#f5f5f5] px-4 text-center",children:[t.jsx(_,{title:"Guest"}),t.jsxs("div",{children:[R&&t.jsx("div",{className:"fixed top-0 left-0 z-50 w-full bg-yellow-500 py-1 text-center text-sm text-white shadow",children:"Retrying connection to server..."}),p==="language"&&t.jsxs("div",{className:"space-y-6",children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-800 dark:text-gray-100",children:"Please choose your language"}),t.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[t.jsx(h,{onClick:()=>y("en"),children:t.jsx(x,{className:"py-10 text-xl font-semibold",children:"English"})}),t.jsx(h,{onClick:()=>y("ar"),children:t.jsx(x,{className:"py-10 text-xl font-semibold",children:"Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©"})})]})]}),p==="service"&&a.language&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"space-y-6",children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-800 dark:text-gray-100",children:a.language==="en"?"Please select a service":"Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø®Ø¯Ù…Ø©"}),t.jsx("div",{className:"mx-auto grid max-w-md grid-cols-1 gap-6 md:grid-cols-2",children:E.map(e=>t.jsx(h,{onClick:()=>b(e),className:"cursor-pointer transition-transform hover:scale-105",children:t.jsx(x,{className:"py-10 text-xl font-semibold",children:e.name})},e.id))})]}),t.jsx("div",{className:"absolute left-[-500px]",children:t.jsx(F,{value:r||"",onChange:k,autoFocus:!0})})]})]})]})}export{V as default};
