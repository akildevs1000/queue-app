import{r,m as me,j as e,K as H,L as fe}from"./app-Cypm5SPE.js";import{U as be,A as pe}from"./app-layout-CvANktyZ.js";import{B as S}from"./button-C4sP26Yr.js";import{D as ye,a as je,b as ve}from"./dialog-8w8DPDNo.js";import{G as ke}from"./GradientButton-Bmc2cqhf.js";import{I as Se}from"./input-Dz2S-Wg8.js";import{T as Q,a as Y,b as R,c as K,d as I,e as E,u as we,f as z,S as Ne,g as _e,h as Ce,i as Te,l as De,o as Pe,p as Le}from"./table-CQSVktkq.js";import{R as X,B as q,X as Z,Y as ee,T as te,L as se,a as ae}from"./BarChart-iaEM6Lws.js";import{C as Re}from"./index-DYdEpwJE.js";import{c as re}from"./app-logo-icon-CDnx8l7n.js";import"./utils-jAU0Cazi.js";import"./index-BKy923sB.js";import"./index-DNudHcCB.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],Ee=re("Activity",Fe);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],V=re("Clock",Ae);function Me({title:s,onSubmitData:o}){const[d,n]=r.useState(!1),{data:c,setData:x,processing:i}=me({token_number_display:""}),f=l=>{l.preventDefault(),o(c.token_number_display),n(!1),x("token_number_display","")};return e.jsxs(ye,{open:d,onOpenChange:n,children:[e.jsx(je,{asChild:!0,children:e.jsx(ke,{className:"rounded-lg bg-indigo-500 p-6 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:s})}),e.jsxs(ve,{children:[e.jsx("h2",{className:"text-xl font-bold",children:s}),e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsx("div",{className:"max-w-md",children:e.jsx(Se,{placeholder:"Token",type:"text",value:c.token_number_display,onChange:l=>x("token_number_display",l.target.value)})}),e.jsx(S,{className:"w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white",type:"submit",disabled:i,children:"Call"})]})]})]})}const Oe=()=>{const{auth:s}=H().props,[o,d]=r.useState(null),[n,c]=r.useState(null),[x,i]=r.useState(!1),[f,l]=r.useState("Next"),[h,y]=r.useState("Recall"),[b,_]=r.useState(null),[B,p]=r.useState(null),[m,u]=r.useState(null),[C,F]=r.useState(null),[T,v]=r.useState(!1),[P,M]=r.useState(0),[ne,A]=r.useState(0),[w,J]=r.useState(null),L=r.useRef(null);s.user;const O=async()=>{try{const t=await(await fetch("/token-counts")).json();d(t)}catch(a){console.error("Failed to fetch services",a)}},oe=async a=>{try{let g=await(await fetch(`/manual-call/${a}`)).json();if(!(g!=null&&g.id))return;c(g),_(Date.now()),v(!0);const j=await(await fetch(`/start-serving/${g.id}`)).json();if(j&&j.counter){const k=L.current;if(k&&k.readyState===WebSocket.OPEN){const D={event:"token-serving",data:j};J(D),k.send(JSON.stringify(D)),k.send(JSON.stringify({event:"feedback",data:{counter_id:(C==null?void 0:C.id)||0,token_id:g.id,...j}}))}else console.warn("WebSocket is not open.")}}catch(t){console.error("Failed to fetch services",t)}},le=async()=>{try{const t=await(await fetch("/feedback-by-counter")).json();p(t)}catch(a){console.error("Failed to fetch feedback-by-counter",a)}},ie=async()=>{if(!(n!=null&&n.token_number_display))return;y(`Recalling ${n==null?void 0:n.token_number_display}`),i(!0);const a=L.current;a&&a.readyState===WebSocket.OPEN?(console.log("ðŸš€ ~ reCall ~ announcerPayload:",w),a.send(JSON.stringify(w))):console.warn("WebSocket is not open.");let t;return t=setTimeout(()=>{i(!1),y("Recall")},5e3),()=>clearTimeout(t)},ce=()=>{if(T&&b!==null){const a=Date.now(),t=Math.floor((a-b)/1e3);M(g=>g+t),_(null),v(!1)}},de=()=>{!T&&n&&(_(Date.now()),v(!0))},ge=()=>{T?ce():de()},xe=async()=>{if(!(n!=null&&n.token_number_display))return;let a=P;if(T&&b!==null){const t=Date.now();a+=Math.floor((t-b)/1e3)}console.log("Total time served:",$(a));try{if(await fetch(`/end-serving/${n==null?void 0:n.id}?total_serving_time_display=${$(a)}`),M(0),_(null),v(!1),A(0),c(null),!(w!=null&&w.data))return;const t=L.current;if((t==null?void 0:t.readyState)===WebSocket.OPEN){const g={event:"token-serving-end",data:w.data};console.log("ðŸš€ Sending token-serving-end event:",g),t.send(JSON.stringify(g)),O()}else console.warn("âš ï¸ WebSocket is not open.")}catch(t){console.error("Failed to fetch services",t)}},ue=async()=>{if(!(w!=null&&w.data))return;const a=L.current;if((a==null?void 0:a.readyState)===WebSocket.OPEN){const t={event:"token-serving-end",data:w.data};console.log("ðŸš€ Sending token-serving-end event:",t),a.send(JSON.stringify(t))}else console.warn("âš ï¸ WebSocket is not open.");try{await fetch(`/no-show-serving/${n==null?void 0:n.id}`),M(0),_(null),v(!1),A(0),c(null)}catch(t){console.error("Failed to fetch services",t)}},he=async()=>{if(!(n!=null&&n.token_number_display)){i(!0),l("Calling Next");try{let t=await(await fetch("/next-token")).json();if(!(t!=null&&t.id))return;c(t),_(Date.now()),v(!0);const N=await(await fetch(`/start-serving/${t.id}`)).json();if(N&&N.counter){const j=L.current;if(j&&j.readyState===WebSocket.OPEN){const k={event:"token-serving",data:N};console.log("ðŸš€ ~ nextToken ~ socketPacket:",k),J(k),j.send(JSON.stringify(k)),j.send(JSON.stringify({event:"feedback",data:{counter_id:(C==null?void 0:C.id)||0,token_id:t.id,...N}}))}else console.warn("WebSocket is not open.")}}catch(a){console.error("Failed to fetch services",a)}finally{let a;return a=setTimeout(()=>{i(!1),l("Next")},1e3),()=>clearTimeout(a)}}},$=a=>{const t=String(Math.floor(a/3600)).padStart(2,"0"),g=String(Math.floor(a%3600/60)).padStart(2,"0"),N=String(a%60).padStart(2,"0");return`${t}:${g}:${N}`},U=async()=>{var g,N,j,k;if(!((g=s==null?void 0:s.user)!=null&&g.ip)||!((N=s==null?void 0:s.user)!=null&&N.ip)){console.log("ðŸš€ ~ handleSocketConnect ~ auth?.user:",s==null?void 0:s.user),u("Socket not connected");return}u(null);let a=`ws://${(j=s==null?void 0:s.user)==null?void 0:j.ip}:${(k=s==null?void 0:s.user)==null?void 0:k.port}`;const t=new WebSocket(a);return L.current=t,t.addEventListener("open",()=>{console.log("Connected to WS server")}),t.addEventListener("message",D=>{try{const W=JSON.parse(D.data);W.event==="new-ticket"&&(console.log("Received new-ticket event:",W),O())}catch{console.error("Failed to parse message:",D.data)}}),t.addEventListener("error",D=>{console.error("WebSocket error:",D)}),()=>{t.close()}};return r.useEffect(()=>{U();const a=async()=>{try{const g=await(await fetch("/counter-by-user")).json();F(g)}catch(t){console.error("Failed to fetch last login",t)}};le(),a(),O()},[]),r.useEffect(()=>{let a;return T&&b!==null?a=setInterval(()=>{const t=Date.now(),g=Math.floor((t-b)/1e3);A(P+g)},1e3):A(P),()=>clearInterval(a)},[T,b,P]),e.jsxs("div",{className:"flex h-full w-full px-15 text-gray-800 dark:bg-gray-900 dark:text-gray-900",children:[e.jsxs("div",{className:"mt-15  flex w-1/2 flex-col",children:[e.jsx("div",{children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("h2",{className:"mb-2 text-lg font-medium text-orange-600 dark:text-orange-400",children:"Current Serving"}),e.jsx("h1",{className:"mb-2 text-2xl font-bold text-blue-900 dark:text-blue-300",children:"Token Number"}),e.jsx("div",{className:"w-fit rounded-xl border-2 border-orange-500 px-12 text-[64px] font-bold text-orange-600 dark:border-orange-400 dark:text-orange-400",children:(n==null?void 0:n.token_number_display)??"---"}),e.jsxs("div",{className:"mt-6 text-center",children:[e.jsx("p",{className:"mb-1 text-sm text-gray-500 dark:text-gray-400",children:"Serving Time"}),e.jsxs("p",{className:"text-3xl font-bold text-blue-900 dark:text-blue-300",children:[" ",$(ne)]})]})]})}),e.jsxs("div",{className:"mt-8 flex justify-between text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"mb-1 text-lg font-medium text-gray-500 dark:text-gray-400",children:"Total Served Tokens"}),e.jsx("p",{className:"text-xl font-bold text-blue-900 dark:text-blue-300",children:o==null?void 0:o.served})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-1 text-lg font-medium text-gray-500 dark:text-gray-400",children:"Total Pending"}),e.jsx("p",{className:"text-xl font-bold text-orange-600 dark:text-orange-400",children:o==null?void 0:o.pending})]})]})]}),e.jsx("div",{className:"mx-4 w-px bg-gray-300 dark:bg-gray-600"}),e.jsxs("div",{className:"flex  h-full w-1/2 flex-col justify-center px-15",children:[m&&e.jsx("div",{className:"mb-4 flex w-full justify-center",children:e.jsxs(S,{onClick:()=>{U()},className:"rounded-lg bg-orange-500 p-6 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:[m," Reconnect"]})}),!m&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-0 flex flex-wrap gap-6 lg:flex-nowrap"}),e.jsx("div",{className:"flex flex-col items-center space-y-4",children:e.jsxs("div",{className:"grid w-full max-w-xl grid-cols-2 gap-4",children:[e.jsx(S,{onClick:he,className:"rounded-lg bg-indigo-500 p-6 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:f}),e.jsx(S,{onClick:xe,className:"rounded-lg bg-indigo-500 p-6 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:"End"}),e.jsx(S,{onClick:ue,className:"rounded-lg bg-indigo-500 p-6 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:"No Show"}),e.jsx(S,{onClick:ie,className:"rounded-lg bg-indigo-500 p-6 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:h}),e.jsx(S,{onClick:ge,className:"rounded-lg bg-indigo-500 p-6 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:T?"Resume":"Pause"}),e.jsx(Me,{title:"Manual Call",onSubmitData:oe})]})})]})]})]})};function $e(){const[s,o]=r.useState([]),[d,n]=r.useState({current_page:1,last_page:1,total:0}),[c,x]=r.useState(!0),i=async(f=1)=>{try{x(!0);const h=await(await fetch(`/login-logs?page=${f}`)).json();o(h.data),n({current_page:h.current_page,last_page:h.last_page,total:h.total})}catch(l){console.error("Failed to fetch login logs",l)}finally{x(!1)}};return r.useEffect(()=>{i()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4 font-bold",children:"Login History"}),e.jsxs(Q,{children:[e.jsx(Y,{children:e.jsxs(R,{children:[e.jsx(K,{children:"Date"}),e.jsx(K,{children:"IP Address"})]})}),e.jsx(I,{children:s.length?s.map((f,l)=>e.jsxs(R,{children:[e.jsx(E,{children:f.formatted_logged_in_at}),e.jsx(E,{children:f.ip_address})]},l)):e.jsx(R,{children:e.jsx(E,{colSpan:3,className:"py-6 text-center",children:c?"Loading...":"No login records found."})})})]}),e.jsxs("div",{className:"mt-4 flex justify-between",children:[e.jsxs("div",{children:["Page ",d.current_page," of ",d.last_page]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx(S,{variant:"outline",disabled:d.current_page===1,onClick:()=>i(d.current_page-1),children:"Previous"}),e.jsx(S,{variant:"outline",disabled:d.current_page===d.last_page,onClick:()=>i(d.current_page+1),children:"Next"})]})]})]})}function We(){const[s,o]=r.useState([]),[d,n]=r.useState([]),c=["#8884d8","#82ca9d","#ffc658","#ff7f50","#a569bd","#f4d03f","#5dade2","#48c9b0"];return r.useEffect(()=>{(async()=>{try{const i=new URL("/peak-day-report",window.location.origin),l=await(await fetch(i.toString())).json();if(o(l),l.length){const h=Object.keys(l[0]).filter(y=>y!=="date");n(h)}}catch(i){console.error("Failed to fetch data:",i)}})()},[]),e.jsx("div",{className:"flex flex-1 flex-col gap-4 rounded-xl p-4",children:e.jsxs("div",{className:"gap-4 rounded-xl bg-[var(--background)] p-1 text-[var(--foreground)] dark:border-gray-700",children:[e.jsx("h2",{className:"mb-4 text-lg font-semibold",children:"Peak Day (Last Week)"}),e.jsxs("div",{children:[e.jsx("h3",{style:{textAlign:"center"},children:"Queue Flow (to identify peak Day)"}),e.jsx(X,{height:300,children:e.jsxs(q,{data:s,margin:{top:20,right:50,left:50},barCategoryGap:10,barGap:1,children:[e.jsx(Z,{dataKey:"date"}),e.jsx(ee,{label:{value:"Number Of Token",angle:-90,position:"insideLeft",offset:10}}),e.jsx(te,{}),e.jsx(se,{}),d.map((x,i)=>e.jsx(ae,{dataKey:x,fill:c[i%c.length],barSize:5},x))]})})]})]})})}function Ke(){const[s,o]=r.useState([]),[d,n]=r.useState([]),c=["#8884d8","#82ca9d","#ffc658","#ff7f50","#a569bd","#f4d03f","#5dade2","#48c9b0"];return r.useEffect(()=>{(async()=>{try{const i=new URL("/peak-hour-report",window.location.origin),l=await(await fetch(i.toString())).json();if(o(l),l.length>0){const h=l[0],y=Object.keys(h).filter(b=>b!=="time");n(y)}}catch(i){console.error("Failed to fetch data:",i)}})()},[]),e.jsx("div",{className:"flex flex-1 flex-col gap-4 rounded-xl p-4",children:e.jsxs("div",{className:"gap-4 rounded-xl bg-[var(--background)] p-1 text-[var(--foreground)] dark:border-gray-700",children:[e.jsx("h2",{className:"mb-4 text-lg font-semibold",children:"Peak Hours (Yesterday)"}),e.jsxs("div",{children:[e.jsx("h3",{style:{textAlign:"center"},children:"Queue Flow (to identify peak Day)"}),e.jsx(X,{height:300,children:e.jsxs(q,{data:s,margin:{top:20,right:50,left:50},barCategoryGap:10,barGap:1,children:[e.jsx(Z,{dataKey:"time"}),e.jsx(ee,{label:{value:"Number Of Token",angle:-90,position:"insideLeft",offset:10}}),e.jsx(te,{}),e.jsx(se,{}),d.map((x,i)=>e.jsx(ae,{dataKey:x,fill:c[i%c.length],barSize:5},x))]})})]})]})})}const G=[{cell:({row:s})=>s.index+1,header:"#"},{accessorKey:"service.name",header:"Service",id:"serviceName"},{accessorKey:"token_number_display",header:"Token"},{accessorKey:"counter.name",header:"Counter",id:"counterName"},{accessorKey:"user.name",header:"User"},{accessorKey:"language",header:"Language"},{accessorKey:"status",header:"Status",cell:({getValue:s})=>{const o={0:"Pending",1:"Not Answered",2:"Serving",3:"Served"},d=s(),n=o[d]||"Unknown Status";let c="inline-block rounded px-2 py-1 text-xs font-semibold";switch(d){case"2":c+=" bg-green-100 text-green-800 dark:bg-green-800/30 dark:text-green-300";break;case"3":c+=" bg-blue-100 text-blue-800 dark:bg-blue-800/30 dark:text-blue-300";break;case"0":c+=" bg-yellow-100 text-yellow-800 dark:bg-yellow-800/30 dark:text-yellow-300";break;case"1":c+=" bg-red-100 text-red-800 dark:bg-red-800/30 dark:text-red-300";break;default:c+=" bg-gray-100 text-gray-800 dark:bg-gray-800/30 dark:text-gray-300";break}return e.jsx("span",{className:c,children:n})}},{accessorKey:"total_serving_time_display",header:"Serving Time",cell:({getValue:s})=>{const o=s();return o===null?"---":o}},{accessorKey:"created_at_formatted",header:"Date Time"}];function Be(){const[s,o]=r.useState([]),[d,n]=r.useState([]),[c,x]=r.useState({}),[i,f]=r.useState({}),[l,h]=r.useState([]),[y,b]=r.useState({pageIndex:0,pageSize:10}),[_,B]=r.useState(0),p=we({data:l,columns:G,state:{sorting:s,columnFilters:d,columnVisibility:c,rowSelection:i,pagination:y},onSortingChange:o,onColumnFiltersChange:n,onColumnVisibilityChange:x,onRowSelectionChange:f,onPaginationChange:b,manualPagination:!0,pageCount:_,getCoreRowModel:Le(),getPaginationRowModel:Pe()});return r.useEffect(()=>{(async()=>{try{const u=y.pageIndex+1,C=y.pageSize,F=new URL("/get-report-data",window.location.origin);F.searchParams.append("page",u.toString()),F.searchParams.append("per_page",C.toString());const v=await(await fetch(F.toString())).json();h(v.data),B(v.last_page),v.current_page!==u&&b(P=>({...P,pageIndex:v.current_page-1}))}catch(u){console.error("Failed to fetch tokens:",u)}})()},[y.pageIndex,y.pageSize]),e.jsxs(e.Fragment,{children:[e.jsxs(Q,{children:[e.jsx(Y,{children:p.getHeaderGroups().map(m=>e.jsx(R,{children:m.headers.map(u=>e.jsx(K,{children:u.isPlaceholder?null:z(u.column.columnDef.header,u.getContext())},u.id))},m.id))}),e.jsx(I,{children:p.getRowModel().rows.length?p.getRowModel().rows.map(m=>e.jsx(R,{children:m.getVisibleCells().map(u=>e.jsx(E,{children:z(u.column.columnDef.cell,u.getContext())},u.id))},m.id)):e.jsx(R,{children:e.jsx(E,{colSpan:G.length,className:"h-24 text-center",children:"No results."})})})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"Rows per page:"}),e.jsxs(Ne,{value:String(p.getState().pagination.pageSize),onValueChange:m=>{p.setPageSize(Number(m)),b(u=>({...u,pageIndex:0,pageSize:Number(m)}))},children:[e.jsx(_e,{className:"w-[100px]",children:e.jsx(Ce,{})}),e.jsx(Te,{children:[5,10,20,50,100].map(m=>e.jsx(De,{value:String(m),children:m},m))})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{variant:"outline",onClick:()=>p.previousPage(),disabled:!p.getCanPreviousPage(),children:"Previous"}),e.jsxs("span",{children:["Page ",p.getState().pagination.pageIndex+1," of ",p.getPageCount()]}),e.jsx(S,{variant:"outline",onClick:()=>p.nextPage(),disabled:!p.getCanNextPage(),children:"Next"})]})]})]})}const Je=[{title:"Dashboard",href:"/dashboard"}];function st({items:s}){var i,f;console.log("ðŸš€ ~ Dashboard ~ items:",s);const{auth:o}=H().props,d=[{title:"Total Visits Today",value:s.total_visits,icon:e.jsx(be,{className:"h-8 w-8 text-blue-500"})},{title:"Total in Served",value:s.served,icon:e.jsx(Re,{className:"h-8 w-8 text-green-500"})},{title:"Total in Serving",value:s.serving,icon:e.jsx(V,{className:"h-8 w-8 text-blue-500"})},{title:"Total in Queue",value:s.pending,icon:e.jsx(V,{className:"h-8 w-8 text-yellow-500"})},{title:"Avg. Wait Time",value:`${s.avgTimeInMinutes} Min`,icon:e.jsx(Ee,{className:"h-8 w-8 text-green-500"})}],[n,c]=r.useState([]),x=async()=>{try{const h=await(await fetch("/tokens")).json();console.log("ðŸš€ ~ fetchTokenCounts ~ json:",h),c(h.data)}catch(l){console.error("Failed to fetch services",l)}};return r.useEffect(()=>{x()},[]),e.jsxs(pe,{breadcrumbs:Je,children:[e.jsx(fe,{title:"Queue Management Dashboard"}),((i=o==null?void 0:o.user)==null?void 0:i.type)==="master"&&e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 p-4",children:[e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 xl:grid-cols-5",children:d.map((l,h)=>e.jsxs("div",{className:"flex items-center justify-between rounded-xl border p-4 shadow-sm dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:l.title}),e.jsx("p",{className:"mt-2 text-2xl font-semibold text-gray-900 dark:text-white",children:l.value})]}),e.jsx("div",{className:"ml-4",children:l.icon})]},h))}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx("div",{className:"rounded-xl border border-gray-200 bg-[var(--background)] p-4 text-[var(--foreground)] dark:border-gray-700",children:e.jsx(We,{})}),e.jsx("div",{className:"rounded-xl border border-gray-200 bg-[var(--background)] p-4 text-[var(--foreground)] dark:border-gray-700",children:e.jsx(Ke,{})})]}),e.jsx("div",{className:"rounded-xl border border-gray-200 bg-[var(--background)] p-4 text-[var(--foreground)] dark:border-gray-700",children:e.jsx(Be,{})}),e.jsx("div",{className:"w-full rounded-lg border border-gray-100 bg-[var(--background)] p-4 p-6 text-[var(--foreground)] shadow dark:border-gray-700 dark:bg-gray-900",children:e.jsx($e,{})})]}),((f=o==null?void 0:o.user)==null?void 0:f.type)==="user"&&e.jsx(Oe,{})]})}export{st as default};
