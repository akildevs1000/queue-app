import{j as e,K as p,r as i,m as b,L as k}from"./app-R_4sylby.js";import{C as N,a as x}from"./card-BAY2G75a.js";import{c as y}from"./utils-jAU0Cazi.js";const S=({name:c="ABC Hospital",token_number_display:t,service:a,already_waiting_count:m,estimated_wait_time:l,date:d,time:n,code:o})=>e.jsxs("div",{className:"mx-auto w-[260px] border border-dashed border-gray-300 bg-white p-2 font-mono text-sm text-black shadow-md",children:[e.jsx("div",{className:"text-sm font-semibold",children:c}),e.jsx("div",{className:"text-md mt-2",children:"Ticket"}),e.jsxs("div",{className:"my-1 text-3xl font-bold",children:[" ",t]}),e.jsxs("div",{className:"mb-2 text-sm",children:[n," ",d]}),e.jsx("div",{className:"text-sm",children:"You will be Served"}),e.jsxs("div",{className:"text-sm font-semibold",children:[a," ","SEC"," ",o]}),e.jsxs("div",{className:"mt-4 text-xs",children:["Total: ",m," token waiting for service",e.jsx("br",{}),"Average waiting time ",l]})]});function g({children:c,className:t,...a}){return e.jsx(N,{className:y("bg-gradient-to-r from-blue-500 to-purple-600 text-white cursor-pointer hover:scale-105 transition-transform border-none",t),...a,children:c})}function _(){const{ticketInfo:c}=p().props,[t,a]=i.useState("language"),[m,l]=i.useState([]),d=i.useRef(null),{data:n,setData:o,post:h}=b({language:"",service_id:0,service_name:"",code:""}),f=async s=>{try{const j=await(await fetch(`/service-list?language=${s}`)).json();l(j)}catch(r){console.error("Failed to fetch services",r)}},u=s=>{o("language",s),a("service"),f(s)},v=s=>{const r={language:n.language,service_id:s.id,code:s.code,service_name:s.name};o(r)};return i.useEffect(()=>{const s=new WebSocket("ws://192.168.3.46:8080");return d.current=s,s.addEventListener("open",()=>{console.log("Connected to WS server")}),s.addEventListener("error",r=>{console.error("WebSocket error:",r)}),()=>{s.close()}},[]),i.useEffect(()=>{n.service_id&&h("/tokens",{onSuccess:()=>{a("thankyou");const s=d.current;if(s&&s.readyState===WebSocket.OPEN){const r={event:"new-ticket"};s.send(JSON.stringify(r))}else console.warn("WebSocket is not open.")},onFinish:()=>{},onError:s=>{console.error("Form submission failed",s)}})},[n]),i.useEffect(()=>{let s;return t==="thankyou"&&(s=setTimeout(()=>{a("language"),o({language:"",service_id:0,service_name:"",code:""}),l([])},5e3)),()=>clearTimeout(s)},[t,o]),e.jsxs("div",{className:"flex min-h-screen flex-col items-center justify-center bg-[#f5f5f5] px-4 text-center",children:[e.jsx(k,{title:"Guest"}),e.jsxs("div",{children:[t==="language"&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 dark:text-gray-100",children:"Please choose your language"}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsx(g,{onClick:()=>u("en"),children:e.jsx(x,{className:"py-10 text-xl font-semibold",children:"English"})}),e.jsx(g,{onClick:()=>u("ar"),children:e.jsx(x,{className:"py-10 text-xl font-semibold",children:"العربية"})})]})]}),t==="service"&&n.language&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 dark:text-gray-100",children:n.language==="en"?"Please select a service":"الرجاء اختيار الخدمة"}),e.jsx("div",{className:"mx-auto grid max-w-md grid-cols-1 gap-6 md:grid-cols-2",children:m.map(s=>e.jsx(g,{onClick:()=>v(s),className:"cursor-pointer transition-transform hover:scale-105",children:e.jsx(x,{className:"py-10 text-xl font-semibold",children:s.name})},s.id))})]})]}),e.jsx("div",{children:t==="thankyou"&&c&&e.jsx(S,{...c})})]})}export{_ as default};
