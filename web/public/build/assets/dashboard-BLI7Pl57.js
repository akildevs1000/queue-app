import{r as a,m as he,j as e,K as G,L as me}from"./app-DpNGodYH.js";import{U as fe,A as be}from"./app-layout-CS9B5HHy.js";import{B as k}from"./button-Hzt0pO9I.js";import{D as pe,a as ye,b as je}from"./dialog-tLMGtazg.js";import{G as ve}from"./GradientButton-DMsBN2ZO.js";import{I as ke}from"./input-QsrD8bdi.js";import{T as H,a as Q,b as L,c as W,d as Y,e as F,u as Se,f as U,S as we,g as Ne,h as _e,i as Ce,l as Te,o as De,p as Pe}from"./table-DEGqVKpL.js";import{R as I,B as X,X as q,Y as Z,T as ee,L as te,a as se}from"./BarChart-DsVjfKwJ.js";import{C as Le}from"./index-J5g1GaK2.js";import{c as ae}from"./app-logo-icon-DC-YBkIh.js";import"./utils-jAU0Cazi.js";import"./index-kUNijarh.js";import"./index-CzPmBcVj.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],Fe=ae("Activity",Re);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],z=ae("Clock",Ee);function Ae({title:i,onSubmitData:n}){const[g,r]=a.useState(!1),{data:c,setData:x,processing:l}=he({token_number_display:""}),f=o=>{o.preventDefault(),n(c.token_number_display),r(!1),x("token_number_display","")};return e.jsxs(pe,{open:g,onOpenChange:r,children:[e.jsx(ye,{asChild:!0,children:e.jsx(ve,{className:"rounded-lg bg-indigo-500 p-6 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:i})}),e.jsxs(je,{children:[e.jsx("h2",{className:"text-xl font-bold",children:i}),e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsx("div",{className:"max-w-md",children:e.jsx(ke,{placeholder:"Token",type:"text",value:c.token_number_display,onChange:o=>x("token_number_display",o.target.value)})}),e.jsx(k,{className:"w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white",type:"submit",disabled:l,children:"Call"})]})]})]})}const Me=()=>{const{auth:i}=G().props,[n,g]=a.useState(null),[r,c]=a.useState(null),[x,l]=a.useState(!1),[f,o]=a.useState("Next"),[u,y]=a.useState("Recall"),[b,N]=a.useState(null),[$,p]=a.useState(null),[h,m]=a.useState(null),[_,R]=a.useState(null),[C,j]=a.useState(!1),[D,A]=a.useState(0),[re,E]=a.useState(0),[S,K]=a.useState(null),P=a.useRef(null);i.user;const M=async()=>{try{const t=await(await fetch("/token-counts")).json();g(t)}catch(s){console.error("Failed to fetch services",s)}},ne=async s=>{try{let d=await(await fetch(`/manual-call/${s}`)).json();if(!(d!=null&&d.id))return;c(d),N(Date.now()),j(!0);const w=await(await fetch(`/start-serving/${d.id}`)).json();if(w&&w.counter){const T=P.current;if(T&&T.readyState===WebSocket.OPEN){const J={event:"token-serving",data:w};K(J),T.send(JSON.stringify(J)),T.send(JSON.stringify({event:"feedback",data:{counter_id:(_==null?void 0:_.id)||0,token_id:d.id,...w}}))}else console.warn("WebSocket is not open.")}}catch(t){console.error("Failed to fetch services",t)}},oe=async()=>{try{const t=await(await fetch("/feedback-by-counter")).json();p(t)}catch(s){console.error("Failed to fetch feedback-by-counter",s)}},le=async()=>{if(!(r!=null&&r.token_number_display))return;y(`Recalling ${r==null?void 0:r.token_number_display}`),l(!0);const s=P.current;s&&s.readyState===WebSocket.OPEN?(console.log("🚀 ~ reCall ~ announcerPayload:",S),s.send(JSON.stringify(S))):console.warn("WebSocket is not open.");let t;return t=setTimeout(()=>{l(!1),y("Recall")},5e3),()=>clearTimeout(t)},ie=()=>{if(C&&b!==null){const s=Date.now(),t=Math.floor((s-b)/1e3);A(d=>d+t),N(null),j(!1)}},ce=()=>{!C&&r&&(N(Date.now()),j(!0))},de=()=>{C?ie():ce()},ge=async()=>{if(!(r!=null&&r.token_number_display))return;let s=D;if(C&&b!==null){const t=Date.now();s+=Math.floor((t-b)/1e3)}console.log("Total time served:",O(s));try{if(await fetch(`/end-serving/${r==null?void 0:r.id}?total_serving_time_display=${O(s)}`),A(0),N(null),j(!1),E(0),c(null),!(S!=null&&S.data))return;const t=P.current;if((t==null?void 0:t.readyState)===WebSocket.OPEN){const d={event:"token-serving-end",data:S.data};console.log("🚀 Sending token-serving-end event:",d),t.send(JSON.stringify(d)),M()}else console.warn("⚠️ WebSocket is not open.")}catch(t){console.error("Failed to fetch services",t)}},xe=async()=>{if(!(S!=null&&S.data))return;const s=P.current;if((s==null?void 0:s.readyState)===WebSocket.OPEN){const t={event:"token-serving-end",data:S.data};console.log("🚀 Sending token-serving-end event:",t),s.send(JSON.stringify(t))}else console.warn("⚠️ WebSocket is not open.");try{await fetch(`/no-show-serving/${r==null?void 0:r.id}`),A(0),N(null),j(!1),E(0),c(null)}catch(t){console.error("Failed to fetch services",t)}},ue=async()=>{if(!(r!=null&&r.token_number_display)){l(!0),o("Calling Next");try{let t=await(await fetch("/next-token")).json();if(!(t!=null&&t.id))return;c(t),N(Date.now()),j(!0);const v=await(await fetch(`/start-serving/${t.id}`)).json();if(v&&v.counter){const w=P.current;if(w&&w.readyState===WebSocket.OPEN){const T={event:"token-serving",data:v};console.log("🚀 ~ nextToken ~ socketPacket:",T),K(T),w.send(JSON.stringify(T)),w.send(JSON.stringify({event:"feedback",data:{counter_id:(_==null?void 0:_.id)||0,token_id:t.id,...v}}))}else console.warn("WebSocket is not open.")}}catch(s){console.error("Failed to fetch services",s)}finally{let s;return s=setTimeout(()=>{l(!1),o("Next")},1e3),()=>clearTimeout(s)}}},O=s=>{const t=String(Math.floor(s/3600)).padStart(2,"0"),d=String(Math.floor(s%3600/60)).padStart(2,"0"),v=String(s%60).padStart(2,"0");return`${t}:${d}:${v}`},B=async()=>{m(null);let s="ws://192.168.3.244:7777";const t=new WebSocket(s);return P.current=t,t.addEventListener("open",()=>{console.log("Connected to WS server")}),t.addEventListener("message",d=>{try{const v=JSON.parse(d.data);v.event==="new-ticket"&&(console.log("Received new-ticket event:",v),M())}catch{console.error("Failed to parse message:",d.data)}}),t.addEventListener("error",d=>{console.error("WebSocket error:",d)}),()=>{t.close()}};return a.useEffect(()=>{B();const s=async()=>{try{const d=await(await fetch("/counter-by-user")).json();R(d)}catch(t){console.error("Failed to fetch last login",t)}};oe(),s(),M()},[]),a.useEffect(()=>{let s;return C&&b!==null?s=setInterval(()=>{const t=Date.now(),d=Math.floor((t-b)/1e3);E(D+d)},1e3):E(D),()=>clearInterval(s)},[C,b,D]),e.jsxs("div",{className:"flex h-full w-full px-15 text-gray-800 dark:bg-gray-900 dark:text-gray-900",children:[e.jsxs("div",{className:"mt-15  flex w-1/2 flex-col",children:[e.jsx("div",{children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("h2",{className:"mb-2 text-lg font-medium text-orange-600 dark:text-orange-400",children:"Current Serving"}),e.jsx("h1",{className:"mb-2 text-2xl font-bold text-blue-900 dark:text-blue-300",children:"Token Number"}),e.jsx("div",{className:"w-fit rounded-xl border-2 border-orange-500 px-12 text-[64px] font-bold text-orange-600 dark:border-orange-400 dark:text-orange-400",children:(r==null?void 0:r.token_number_display)??"---"}),e.jsxs("div",{className:"mt-6 text-center",children:[e.jsx("p",{className:"mb-1 text-sm text-gray-500 dark:text-gray-400",children:"Serving Time"}),e.jsxs("p",{className:"text-3xl font-bold text-blue-900 dark:text-blue-300",children:[" ",O(re)]})]})]})}),e.jsxs("div",{className:"mt-8 flex justify-between text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"mb-1 text-lg font-medium text-gray-500 dark:text-gray-400",children:"Total Served Tokens"}),e.jsx("p",{className:"text-xl font-bold text-blue-900 dark:text-blue-300",children:n==null?void 0:n.served})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-1 text-lg font-medium text-gray-500 dark:text-gray-400",children:"Total Pending"}),e.jsx("p",{className:"text-xl font-bold text-orange-600 dark:text-orange-400",children:n==null?void 0:n.pending})]})]})]}),e.jsx("div",{className:"mx-4 w-px bg-gray-300 dark:bg-gray-600"}),e.jsxs("div",{className:"flex  h-full w-1/2 flex-col justify-center px-15",children:[h&&e.jsx("div",{className:"mb-4 flex w-full justify-center",children:e.jsxs(k,{onClick:()=>{B()},className:"rounded-lg bg-orange-500 p-6 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:[h," Reconnect"]})}),!h&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-0 flex flex-wrap gap-6 lg:flex-nowrap"}),e.jsx("div",{className:"flex flex-col items-center space-y-4",children:e.jsxs("div",{className:"grid w-full max-w-xl grid-cols-2 gap-4",children:[e.jsx(k,{onClick:ue,className:"rounded-lg bg-indigo-500 p-6 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:f}),e.jsx(k,{onClick:ge,className:"rounded-lg bg-indigo-500 p-6 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:"End"}),e.jsx(k,{onClick:xe,className:"rounded-lg bg-indigo-500 p-6 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:"No Show"}),e.jsx(k,{onClick:le,className:"rounded-lg bg-indigo-500 p-6 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:u}),e.jsx(k,{onClick:de,className:"rounded-lg bg-indigo-500 p-6 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:C?"Resume":"Pause"}),e.jsx(Ae,{title:"Manual Call",onSubmitData:ne})]})})]})]})]})};function Oe(){const[i,n]=a.useState([]),[g,r]=a.useState({current_page:1,last_page:1,total:0}),[c,x]=a.useState(!0),l=async(f=1)=>{try{x(!0);const u=await(await fetch(`/login-logs?page=${f}`)).json();n(u.data),r({current_page:u.current_page,last_page:u.last_page,total:u.total})}catch(o){console.error("Failed to fetch login logs",o)}finally{x(!1)}};return a.useEffect(()=>{l()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4 font-bold",children:"Login History"}),e.jsxs(H,{children:[e.jsx(Q,{children:e.jsxs(L,{children:[e.jsx(W,{children:"Date"}),e.jsx(W,{children:"IP Address"})]})}),e.jsx(Y,{children:i.length?i.map((f,o)=>e.jsxs(L,{children:[e.jsx(F,{children:f.formatted_logged_in_at}),e.jsx(F,{children:f.ip_address})]},o)):e.jsx(L,{children:e.jsx(F,{colSpan:3,className:"py-6 text-center",children:c?"Loading...":"No login records found."})})})]}),e.jsxs("div",{className:"mt-4 flex justify-between",children:[e.jsxs("div",{children:["Page ",g.current_page," of ",g.last_page]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx(k,{variant:"outline",disabled:g.current_page===1,onClick:()=>l(g.current_page-1),children:"Previous"}),e.jsx(k,{variant:"outline",disabled:g.current_page===g.last_page,onClick:()=>l(g.current_page+1),children:"Next"})]})]})]})}function We(){const[i,n]=a.useState([]),[g,r]=a.useState([]),c=["#8884d8","#82ca9d","#ffc658","#ff7f50","#a569bd","#f4d03f","#5dade2","#48c9b0"];return a.useEffect(()=>{(async()=>{try{const l=new URL("/peak-day-report",window.location.origin),o=await(await fetch(l.toString())).json();if(n(o),o.length){const u=Object.keys(o[0]).filter(y=>y!=="date");r(u)}}catch(l){console.error("Failed to fetch data:",l)}})()},[]),e.jsx("div",{className:"flex flex-1 flex-col gap-4 rounded-xl p-4",children:e.jsxs("div",{className:"gap-4 rounded-xl bg-[var(--background)] p-1 text-[var(--foreground)] dark:border-gray-700",children:[e.jsx("h2",{className:"mb-4 text-lg font-semibold",children:"Peak Day (Last Week)"}),e.jsxs("div",{children:[e.jsx("h3",{style:{textAlign:"center"},children:"Queue Flow (to identify peak Day)"}),e.jsx(I,{height:300,children:e.jsxs(X,{data:i,margin:{top:20,right:50,left:50},barCategoryGap:10,barGap:1,children:[e.jsx(q,{dataKey:"date"}),e.jsx(Z,{label:{value:"Number Of Token",angle:-90,position:"insideLeft",offset:10}}),e.jsx(ee,{}),e.jsx(te,{}),g.map((x,l)=>e.jsx(se,{dataKey:x,fill:c[l%c.length],barSize:5},x))]})})]})]})})}function $e(){const[i,n]=a.useState([]),[g,r]=a.useState([]),c=["#8884d8","#82ca9d","#ffc658","#ff7f50","#a569bd","#f4d03f","#5dade2","#48c9b0"];return a.useEffect(()=>{(async()=>{try{const l=new URL("/peak-hour-report",window.location.origin),o=await(await fetch(l.toString())).json();if(n(o),o.length>0){const u=o[0],y=Object.keys(u).filter(b=>b!=="time");r(y)}}catch(l){console.error("Failed to fetch data:",l)}})()},[]),e.jsx("div",{className:"flex flex-1 flex-col gap-4 rounded-xl p-4",children:e.jsxs("div",{className:"gap-4 rounded-xl bg-[var(--background)] p-1 text-[var(--foreground)] dark:border-gray-700",children:[e.jsx("h2",{className:"mb-4 text-lg font-semibold",children:"Peak Hours (Yesterday)"}),e.jsxs("div",{children:[e.jsx("h3",{style:{textAlign:"center"},children:"Queue Flow (to identify peak Day)"}),e.jsx(I,{height:300,children:e.jsxs(X,{data:i,margin:{top:20,right:50,left:50},barCategoryGap:10,barGap:1,children:[e.jsx(q,{dataKey:"time"}),e.jsx(Z,{label:{value:"Number Of Token",angle:-90,position:"insideLeft",offset:10}}),e.jsx(ee,{}),e.jsx(te,{}),g.map((x,l)=>e.jsx(se,{dataKey:x,fill:c[l%c.length],barSize:5},x))]})})]})]})})}const V=[{cell:({row:i})=>i.index+1,header:"#"},{accessorKey:"service.name",header:"Service",id:"serviceName"},{accessorKey:"token_number_display",header:"Token"},{accessorKey:"counter.name",header:"Counter",id:"counterName"},{accessorKey:"user.name",header:"User"},{accessorKey:"language",header:"Language"},{accessorKey:"status",header:"Status",cell:({getValue:i})=>{const n={0:"Pending",1:"Not Answered",2:"Serving",3:"Served"},g=i(),r=n[g]||"Unknown Status";let c="inline-block rounded px-2 py-1 text-xs font-semibold";switch(g){case"2":c+=" bg-green-100 text-green-800 dark:bg-green-800/30 dark:text-green-300";break;case"3":c+=" bg-blue-100 text-blue-800 dark:bg-blue-800/30 dark:text-blue-300";break;case"0":c+=" bg-yellow-100 text-yellow-800 dark:bg-yellow-800/30 dark:text-yellow-300";break;case"1":c+=" bg-red-100 text-red-800 dark:bg-red-800/30 dark:text-red-300";break;default:c+=" bg-gray-100 text-gray-800 dark:bg-gray-800/30 dark:text-gray-300";break}return e.jsx("span",{className:c,children:r})}},{accessorKey:"total_serving_time_display",header:"Serving Time",cell:({getValue:i})=>{const n=i();return n===null?"---":n}},{accessorKey:"created_at_formatted",header:"Date Time"}];function Ke(){const[i,n]=a.useState([]),[g,r]=a.useState([]),[c,x]=a.useState({}),[l,f]=a.useState({}),[o,u]=a.useState([]),[y,b]=a.useState({pageIndex:0,pageSize:10}),[N,$]=a.useState(0),p=Se({data:o,columns:V,state:{sorting:i,columnFilters:g,columnVisibility:c,rowSelection:l,pagination:y},onSortingChange:n,onColumnFiltersChange:r,onColumnVisibilityChange:x,onRowSelectionChange:f,onPaginationChange:b,manualPagination:!0,pageCount:N,getCoreRowModel:Pe(),getPaginationRowModel:De()});return a.useEffect(()=>{(async()=>{try{const m=y.pageIndex+1,_=y.pageSize,R=new URL("/get-report-data",window.location.origin);R.searchParams.append("page",m.toString()),R.searchParams.append("per_page",_.toString());const j=await(await fetch(R.toString())).json();u(j.data),$(j.last_page),j.current_page!==m&&b(D=>({...D,pageIndex:j.current_page-1}))}catch(m){console.error("Failed to fetch tokens:",m)}})()},[y.pageIndex,y.pageSize]),e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsx(Q,{children:p.getHeaderGroups().map(h=>e.jsx(L,{children:h.headers.map(m=>e.jsx(W,{children:m.isPlaceholder?null:U(m.column.columnDef.header,m.getContext())},m.id))},h.id))}),e.jsx(Y,{children:p.getRowModel().rows.length?p.getRowModel().rows.map(h=>e.jsx(L,{children:h.getVisibleCells().map(m=>e.jsx(F,{children:U(m.column.columnDef.cell,m.getContext())},m.id))},h.id)):e.jsx(L,{children:e.jsx(F,{colSpan:V.length,className:"h-24 text-center",children:"No results."})})})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"Rows per page:"}),e.jsxs(we,{value:String(p.getState().pagination.pageSize),onValueChange:h=>{p.setPageSize(Number(h)),b(m=>({...m,pageIndex:0,pageSize:Number(h)}))},children:[e.jsx(Ne,{className:"w-[100px]",children:e.jsx(_e,{})}),e.jsx(Ce,{children:[5,10,20,50,100].map(h=>e.jsx(Te,{value:String(h),children:h},h))})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{variant:"outline",onClick:()=>p.previousPage(),disabled:!p.getCanPreviousPage(),children:"Previous"}),e.jsxs("span",{children:["Page ",p.getState().pagination.pageIndex+1," of ",p.getPageCount()]}),e.jsx(k,{variant:"outline",onClick:()=>p.nextPage(),disabled:!p.getCanNextPage(),children:"Next"})]})]})]})}const Be=[{title:"Dashboard",href:"/dashboard"}];function tt({items:i}){var l,f;console.log("🚀 ~ Dashboard ~ items:",i);const{auth:n}=G().props,g=[{title:"Total Visits Today",value:i.total_visits,icon:e.jsx(fe,{className:"h-8 w-8 text-blue-500"})},{title:"Total in Served",value:i.served,icon:e.jsx(Le,{className:"h-8 w-8 text-green-500"})},{title:"Total in Serving",value:i.serving,icon:e.jsx(z,{className:"h-8 w-8 text-blue-500"})},{title:"Total in Queue",value:i.pending,icon:e.jsx(z,{className:"h-8 w-8 text-yellow-500"})},{title:"Avg. Wait Time",value:`${i.avgTimeInMinutes} Min`,icon:e.jsx(Fe,{className:"h-8 w-8 text-green-500"})}],[r,c]=a.useState([]),x=async()=>{try{const u=await(await fetch("/tokens")).json();console.log("🚀 ~ fetchTokenCounts ~ json:",u),c(u.data)}catch(o){console.error("Failed to fetch services",o)}};return a.useEffect(()=>{x()},[]),e.jsxs(be,{breadcrumbs:Be,children:[e.jsx(me,{title:"Queue Management Dashboard"}),((l=n==null?void 0:n.user)==null?void 0:l.type)==="master"&&e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 p-4",children:[e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 xl:grid-cols-5",children:g.map((o,u)=>e.jsxs("div",{className:"flex items-center justify-between rounded-xl border p-4 shadow-sm dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:o.title}),e.jsx("p",{className:"mt-2 text-2xl font-semibold text-gray-900 dark:text-white",children:o.value})]}),e.jsx("div",{className:"ml-4",children:o.icon})]},u))}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx("div",{className:"rounded-xl border border-gray-200 bg-[var(--background)] p-4 text-[var(--foreground)] dark:border-gray-700",children:e.jsx(We,{})}),e.jsx("div",{className:"rounded-xl border border-gray-200 bg-[var(--background)] p-4 text-[var(--foreground)] dark:border-gray-700",children:e.jsx($e,{})})]}),e.jsx("div",{className:"rounded-xl border border-gray-200 bg-[var(--background)] p-4 text-[var(--foreground)] dark:border-gray-700",children:e.jsx(Ke,{})}),e.jsx("div",{className:"w-full rounded-lg border border-gray-100 bg-[var(--background)] p-4 p-6 text-[var(--foreground)] shadow dark:border-gray-700 dark:bg-gray-900",children:e.jsx(Oe,{})})]}),((f=n==null?void 0:n.user)==null?void 0:f.type)==="user"&&e.jsx(Me,{})]})}export{tt as default};
