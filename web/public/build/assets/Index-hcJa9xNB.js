import{r as a,j as e,L as xe}from"./app-DwP5b3u_.js";import{G as $}from"./GradientButton-COEmZrR2.js";import{R as X,B as Y,X as q,Y as Q,T as W,L as J,a as Z}from"./BarChart-BaHnY3W-.js";import{u as ue,T as ge,a as pe,b as D,c as fe,f as A,d as je,e as E,i as ye,j as ve}from"./table-BtHO8Vm_.js";import{S as R,a as M,b as U,c as F,d as H,e as O,f as z}from"./select-BZwE4n9J.js";import{B}from"./button-Bleivc-D.js";import{c as we,P as be,a as Se,f as v,d as ke,C as Ne}from"./popover-Bh0ZduXo.js";import{c as Ce}from"./utils-jAU0Cazi.js";import{c as Le}from"./app-logo-icon-C1cDhG1I.js";import{T as Te,a as Pe,b as K,c as I}from"./tabs-18yLJqHf.js";import{A as _e}from"./app-layout-BTF7_f1q.js";import"./index-BjBug0kt.js";import"./index-D363wZmi.js";import"./index-Dc60J1YO.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],Re=Le("Download",De);function Me(){const[g,s]=a.useState([]),[b,S]=a.useState([]),j=["#8884d8","#82ca9d","#ffc658","#ff7f50","#a569bd","#f4d03f","#5dade2","#48c9b0"],[k,w]=a.useState({pageIndex:0,pageSize:10});a.useEffect(()=>{(async()=>{try{const o=k.pageIndex+1,m=new URL("/peak-hour-report",window.location.origin),n=await(await fetch(m.toString())).json();if(s(n),n.length>0){const u=n[0],p=Object.keys(u).filter(f=>f!=="time");S(p)}n.current_page!==o&&w(u=>({...u,pageIndex:n.current_page-1}))}catch(o){console.error("Failed to fetch data:",o)}})()},[]);const l=()=>{var c;const i=(c=h.current)==null?void 0:c.querySelector("svg");if(!i)return;const m=new XMLSerializer().serializeToString(i),x=document.createElement("canvas"),n=x.getContext("2d"),u=new Blob([m],{type:"image/svg+xml;charset=utf-8"}),p=URL.createObjectURL(u),f=new Image;f.onload=()=>{x.width=i.clientWidth,x.height=i.clientHeight,n==null||n.drawImage(f,0,0),URL.revokeObjectURL(p);const P=x.toDataURL("image/png"),y=document.createElement("a");y.href=P,y.download="peak-hours-chart.png",y.click()},f.src=p},h=a.useRef(null);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex w-full flex-wrap items-center justify-between gap-2 rounded-lg p-5",children:[e.jsx("div",{}),e.jsx("div",{children:e.jsx($,{onClick:l,children:"Print/Download "})})]}),e.jsx("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:e.jsxs("div",{className:"gap-4 rounded-xl bg-[var(--background)] p-4 text-[var(--foreground)] dark:border-gray-700",children:[e.jsx("h2",{className:"mb-4 text-lg font-semibold",children:"Peak Hours Report (Yesterday)"}),e.jsxs("div",{ref:h,style:{width:"90%",height:400,margin:"auto"},children:[e.jsx("h3",{style:{textAlign:"center"},children:"Queue Flow (to identify peak Hours)"}),e.jsx(X,{width:"100%",height:500,children:e.jsxs(Y,{data:g,margin:{top:20,right:50,left:50,bottom:20},barCategoryGap:10,barGap:1,children:[e.jsx(q,{dataKey:"time"}),e.jsx(Q,{label:{value:"Number Of Token",angle:-90,position:"insideLeft",offset:10}}),e.jsx(W,{}),e.jsx(J,{}),b.map((i,o)=>e.jsx(Z,{dataKey:i,fill:j[o%j.length],barSize:5},i))]})})]})]})})]})}function Ue(){const[g,s]=a.useState([]),[b,S]=a.useState([]),j=["#8884d8","#82ca9d","#ffc658","#ff7f50","#a569bd","#f4d03f","#5dade2","#48c9b0"];a.useEffect(()=>{(async()=>{try{const h=new URL("/peak-day-report",window.location.origin),o=await(await fetch(h.toString())).json();if(s(o),o.length){const m=Object.keys(o[0]).filter(x=>x!=="date");S(m)}}catch(h){console.error("Failed to fetch data:",h)}})()},[]);const k=()=>{var p;const l=(p=w.current)==null?void 0:p.querySelector("svg");if(!l)return;const i=new XMLSerializer().serializeToString(l),o=document.createElement("canvas"),m=o.getContext("2d"),x=new Blob([i],{type:"image/svg+xml;charset=utf-8"}),n=URL.createObjectURL(x),u=new Image;u.onload=()=>{o.width=l.clientWidth,o.height=l.clientHeight,m==null||m.drawImage(u,0,0),URL.revokeObjectURL(n);const f=o.toDataURL("image/png"),c=document.createElement("a");c.href=f,c.download="peak-hours-chart.png",c.click()},u.src=n},w=a.useRef(null);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex w-full flex-wrap items-center justify-between gap-2 rounded-lg p-5",children:[e.jsx("div",{}),e.jsx("div",{children:e.jsx($,{onClick:k,children:"Print/Download "})})]}),e.jsx("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:e.jsxs("div",{className:"gap-4 rounded-xl bg-[var(--background)] p-4 text-[var(--foreground)] dark:border-gray-700",children:[e.jsx("h2",{className:"mb-4 text-lg font-semibold",children:"Peak Hours Report (Yesterday)"}),e.jsxs("div",{ref:w,style:{width:"90%",height:400,margin:"auto"},children:[e.jsx("h3",{style:{textAlign:"center"},children:"Queue Flow (to identify peak Hours)"}),e.jsx(X,{width:"100%",height:500,children:e.jsxs(Y,{data:g,margin:{top:20,right:50,left:50,bottom:20},barCategoryGap:10,barGap:1,children:[e.jsx(q,{dataKey:"date"}),e.jsx(Q,{label:{value:"Number Of Token",angle:-90,position:"insideLeft",offset:10}}),e.jsx(W,{}),e.jsx(J,{}),b.map((l,h)=>e.jsx(Z,{dataKey:l,fill:j[h%j.length],barSize:5},l))]})})]})]})})]})}const G=[{cell:({row:g})=>g.index+1,header:"#"},{accessorKey:"service.name",header:"Service",id:"serviceName"},{accessorKey:"name",header:"Counter",id:"counterName"},{accessorKey:"user.name",header:"User"},{accessorKey:"not_show_count",header:"No Show"},{accessorKey:"served_count",header:"Served"},{accessorKey:"no_show_count_plus_served_count",header:"Total"},{accessorKey:"avgTime",header:"Avg Time"},{accessorKey:"feedback",header:"Feedback"}];function Fe({services:g}){const[s,b]=a.useState({from:we(new Date,0),to:new Date}),[S,j]=a.useState(!1),[k,w]=a.useState([]),[l,h]=a.useState([]),[i,o]=a.useState({}),[m,x]=a.useState({}),[n,u]=a.useState(null),[p,f]=a.useState(null),[c,P]=a.useState(null),[y,ee]=a.useState([]),[te,se]=a.useState([]),[ae,re]=a.useState([]),[ne,oe]=a.useState([]),[N,_]=a.useState({pageIndex:0,pageSize:10}),[ie,le]=a.useState(0),C=ue({data:te,columns:G,state:{sorting:k,columnFilters:l,columnVisibility:i,rowSelection:m,pagination:N},onSortingChange:w,onColumnFiltersChange:h,onColumnVisibilityChange:o,onRowSelectionChange:x,onPaginationChange:_,manualPagination:!0,pageCount:ie,getCoreRowModel:ve(),getPaginationRowModel:ye()});a.useEffect(()=>{(async()=>{try{const r=N.pageIndex+1,T=N.pageSize,d=new URL("/get-summary-report-data",window.location.origin);d.searchParams.append("page",r.toString()),d.searchParams.append("per_page",T.toString()),n!==null&&d.searchParams.append("service_id",n.toString()),c!==null&&d.searchParams.append("counter_id",c.toString()),s!=null&&s.from&&d.searchParams.append("start_date",v(s.from,"yyyy-MM-dd")),s!=null&&s.to&&d.searchParams.append("end_date",v(s.to,"yyyy-MM-dd"));const L=await(await fetch(d.toString())).json();oe(L.total_visits),re(L.stats),se(L.records),le(1),L.current_page!==r&&_(me=>({...me,pageIndex:L.current_page-1}))}catch(r){console.error("Failed to fetch tokens:",r)}})()},[N.pageIndex,N.pageSize,n,c,s]);const ce=async t=>{var T;u(t);const r=(T=g.find(d=>d.id==t))==null?void 0:T.name;f(r);try{const V=await(await fetch(`/counter-list-by-service-id/${t}`)).json();ee(V)}catch(d){console.error("Failed to fetch counters",d)}},de=()=>{if(n==null)return;const t=new URLSearchParams;n&&t.append("service_id",n),c&&t.append("counter_id",c),s!=null&&s.from&&t.append("start_date",v(s.from,"yyyy-MM-dd")),s!=null&&s.to&&t.append("end_date",v(s.to,"yyyy-MM-dd"));const r=`/report/download?${t.toString()}`;window.open(r,"_blank")},he=t=>{P(t)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex w-full flex-wrap items-center justify-between gap-2  p-5",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(R,{onValueChange:ce,children:[e.jsx(M,{className:"w-[180px]",children:e.jsx(U,{placeholder:"Filter by Service"})}),e.jsx(F,{children:e.jsxs(H,{children:[e.jsx(O,{children:"Services"}),g.map(t=>e.jsx(z,{value:t.id,children:t.name},t.id))]})})]}),e.jsxs(R,{onValueChange:he,children:[e.jsx(M,{className:"w-[180px]",children:e.jsx(U,{placeholder:"Filter by Counter"})}),e.jsx(F,{children:e.jsxs(H,{children:[e.jsx(O,{children:"Counter"}),y==null?void 0:y.map(t=>e.jsx(z,{value:t.id,children:t.name},t.id))]})})]}),e.jsxs(be,{open:S,onOpenChange:j,children:[e.jsx(Se,{asChild:!0,children:e.jsx("button",{className:Ce("w-[260px] justify-start rounded-md border px-4 py-2 text-left font-normal",!(s!=null&&s.from)&&!(s!=null&&s.to)&&"text-muted-foreground"),children:s!=null&&s.from?s.to?`${v(s.from,"LLL dd, yyyy")} - ${v(s.to,"LLL dd, yyyy")}`:v(s.from,"LLL dd, yyyy"):"Pick a date range"})}),e.jsx(ke,{className:"w-auto p-0",align:"start",children:e.jsx(Ne,{mode:"range",selected:s,onSelect:t=>{b(t),t!=null&&t.from&&(t!=null&&t.to)&&j(!1)},numberOfMonths:2})})]})]}),e.jsx("div",{children:e.jsxs("button",{onClick:de,className:"inline-flex items-center gap-2 rounded-md bg-blue-600 px-4 py-2 text-white transition-all hover:bg-blue-700",children:[e.jsx(Re,{className:"h-3 w-3"}),"Print/Download"]})})]}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 xl:grid-cols-6",children:[e.jsx("div",{className:"flex items-center justify-between rounded-xl border p-4 shadow-sm dark:border-gray-700",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Total Visits Today"}),e.jsx("p",{className:"mt-2 text-2xl font-semibold text-gray-900 dark:text-white",children:ne})]})}),ae.map((t,r)=>e.jsxs("div",{className:"flex items-center justify-between rounded-xl border p-4 shadow-sm dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:t.service_name}),e.jsx("p",{className:"mt-2 text-2xl text-gray-900 dark:text-white",children:t.service_count})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"AvgTime"}),e.jsx("p",{className:"mt-2 text-gray-900 dark:text-white",children:t.avgTime})]})]},r))]}),e.jsxs("div",{className:"gap-4 rounded-xl border border-gray-200 bg-[var(--background)] text-[var(--foreground)] dark:border-gray-700",children:[e.jsx("div",{className:"p-2 px-4 text-2xl text-black dark:text-white",children:p||"---"}),e.jsxs("div",{className:"p-4",children:[e.jsxs(ge,{children:[e.jsx(pe,{children:C.getHeaderGroups().map(t=>e.jsx(D,{children:t.headers.map(r=>e.jsx(fe,{children:r.isPlaceholder?null:A(r.column.columnDef.header,r.getContext())},r.id))},t.id))}),e.jsx(je,{children:C.getRowModel().rows.length?C.getRowModel().rows.map(t=>e.jsx(D,{children:t.getVisibleCells().map(r=>e.jsx(E,{children:A(r.column.columnDef.cell,r.getContext())},r.id))},t.id)):e.jsx(D,{children:e.jsx(E,{colSpan:G.length,className:"h-24 text-center",children:"No results."})})})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"Rows per page:"}),e.jsxs(R,{value:String(C.getState().pagination.pageSize),onValueChange:t=>{C.setPageSize(Number(t)),_(r=>({...r,pageIndex:0,pageSize:Number(t)}))},children:[e.jsx(M,{className:"w-[100px]",children:e.jsx(U,{})}),e.jsx(F,{children:[5,10,20,50,100].map(t=>e.jsx(z,{value:String(t),children:t},t))})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{variant:"outline",children:"Previous"}),e.jsx("span",{children:"Page 1 of 1"}),e.jsx(B,{variant:"outline",children:"Next"})]})]})]})]})]})]})}function Qe({services:g}){return e.jsxs(_e,{children:[e.jsx(xe,{title:"Report"}),e.jsxs(Te,{defaultValue:"summary",className:"w-full",children:[e.jsxs(Pe,{className:"my-2 ml-auto grid w-[30%] grid-cols-3",children:[e.jsx(K,{value:"summary",children:"Summary"}),e.jsx(K,{value:"peak",children:"Peak Hours"}),e.jsx(K,{value:"peak_day",children:"Peak Day"})]}),e.jsx(I,{value:"summary",children:e.jsx(Fe,{services:g})}),e.jsx(I,{value:"peak",children:e.jsx(Me,{})}),e.jsx(I,{value:"peak_day",children:e.jsx(Ue,{})})]})]})}export{Qe as default};
