import{r as n,j as e,m as q,K as W,L as z}from"./app-R_4sylby.js";import{A as I,U as X}from"./app-layout-DvfumM7A.js";import{B as p}from"./button-BlddmMop.js";import{D as Y,a as Z,b as ee}from"./dialog-CDk3j28K.js";import{G as te}from"./GradientButton-BmXPG-qD.js";import{I as se}from"./input-YlJCkXXJ.js";import{T as re,a as ae,b as E,c as R,d as ne,e as P}from"./table-INaGdMvc.js";import{c as $}from"./app-logo-icon-CqZT3C9X.js";import"./utils-jAU0Cazi.js";import"./index-jFEyj3Xs.js";import"./index-avRgLURJ.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],oe=$("Activity",le);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],de=$("Clock",ie);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]],xe=$("UserCheck",ce);function me(){const[l,d]=n.useState(null),[i,a]=n.useState(!0),x=async()=>{try{a(!0);const o=await(await fetch("/counter-by-user")).json();console.log("ðŸš€ ~ fetchLastLogin ~ json:",o),d(o)}catch(h){console.error("Failed to fetch last login",h)}finally{a(!1)}};return n.useEffect(()=>{x()},[]),e.jsx("div",{className:"",children:i?e.jsx("p",{className:"text-gray-500",children:"Loading..."}):l?e.jsx("div",{className:"space-y-2 text-sm",children:e.jsxs("p",{children:[" ",l.name]})}):e.jsx("p",{className:"text-gray-500",children:"---"})})}function ge(){const[l,d]=n.useState(null),[i,a]=n.useState(!0),x=async()=>{try{a(!0);const o=await(await fetch("/service-by-user")).json();console.log("ðŸš€ ~ fetchLastLogin ~ json:",o),d(o)}catch(h){console.error("Failed to fetch last login",h)}finally{a(!1)}};return n.useEffect(()=>{x()},[]),e.jsx("div",{className:"",children:i?e.jsx("p",{className:"text-gray-500",children:"Loading..."}):l?e.jsx("div",{className:"space-y-2 text-sm",children:e.jsxs("p",{children:[" ",l.name]})}):e.jsx("p",{className:"text-gray-500",children:"No login record found."})})}function he({title:l,onSubmitData:d}){const[i,a]=n.useState(!1),{data:x,setData:h,processing:o}=q({token_number_display:""}),u=m=>{m.preventDefault(),d(x.token_number_display)};return e.jsxs(Y,{open:i,onOpenChange:a,children:[e.jsx(Z,{asChild:!0,children:e.jsx(te,{className:"w-1/2 rounded-lg bg-indigo-500 p-6 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:l})}),e.jsxs(ee,{children:[e.jsx("h2",{className:"text-xl font-bold",children:l}),e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsx("div",{className:"max-w-md",children:e.jsx(se,{placeholder:"Token",type:"text",value:x.token_number_display,onChange:m=>h("token_number_display",m.target.value)})}),e.jsx(p,{className:"w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white",type:"submit",disabled:o,children:o?"Submitting...":"Submit"})]})]})]})}const ue=()=>{const{auth:l}=W().props,[d,i]=n.useState(null),[a,x]=n.useState(null),[h,o]=n.useState(!1),[u,m]=n.useState("Next"),[s,c]=n.useState("Recall"),[b,y]=n.useState(null),[A,pe]=n.useState(null),[j,k]=n.useState(!1),[w,_]=n.useState(0),[F,S]=n.useState(0),[f,O]=n.useState(null),N=n.useRef(null),M=l.user||{name:"John Doe",email:"john@example.com"},C=async()=>{try{const r=await(await fetch("/token-counts")).json();i(r)}catch(t){console.error("Failed to fetch services",t)}},B=async t=>{console.log("Received from child:",t)},J=async()=>{if(!(a!=null&&a.token_number_display))return;c(`Recalling ${a==null?void 0:a.token_number_display}`),o(!0);const t=N.current;t&&t.readyState===WebSocket.OPEN?(console.log("ðŸš€ ~ reCall ~ announcerPayload:",f),t.send(JSON.stringify(f))):console.warn("WebSocket is not open.");let r;return r=setTimeout(()=>{o(!1),c("Recall")},5e3),()=>clearTimeout(r)},U=()=>{if(j&&b!==null){const t=Date.now(),r=Math.floor((t-b)/1e3);_(g=>g+r),y(null),k(!1)}},V=()=>{!j&&a&&(y(Date.now()),k(!0))},H=()=>{j?U():V()},G=async()=>{if(!(a!=null&&a.token_number_display))return;let t=w;if(j&&b!==null){const r=Date.now();t+=Math.floor((r-b)/1e3)}console.log("Total time served:",T(t));try{if(await fetch(`/end-serving/${a==null?void 0:a.id}?total_serving_time_display=${T(t)}`),_(0),y(null),k(!1),S(0),x(null),!(f!=null&&f.data))return;const r=N.current;if((r==null?void 0:r.readyState)===WebSocket.OPEN){const g={event:"token-serving-end",data:f.data};console.log("ðŸš€ Sending token-serving-end event:",g),r.send(JSON.stringify(g)),C()}else console.warn("âš ï¸ WebSocket is not open.")}catch(r){console.error("Failed to fetch services",r)}},K=async()=>{if(!(f!=null&&f.data))return;const t=N.current;if((t==null?void 0:t.readyState)===WebSocket.OPEN){const r={event:"token-serving-end",data:f.data};console.log("ðŸš€ Sending token-serving-end event:",r),t.send(JSON.stringify(r))}else console.warn("âš ï¸ WebSocket is not open.");try{await fetch(`/no-show-serving/${a==null?void 0:a.id}`),_(0),y(null),k(!1),S(0),x(null)}catch(r){console.error("Failed to fetch services",r)}},Q=async()=>{if(!(a!=null&&a.token_number_display)){o(!0),m("Calling Next");try{let r=await(await fetch("/next-token")).json();if(!(r!=null&&r.id))return;x(r),y(Date.now()),k(!0);const v=await(await fetch(`/start-serving/${r.id}`)).json();if(v&&v.counter){const L=N.current;if(L&&L.readyState===WebSocket.OPEN){const D={event:"token-serving",data:v};console.log("ðŸš€ ~ nextToken ~ socketPacket:",D),O(D),L.send(JSON.stringify(D))}else console.warn("WebSocket is not open.")}}catch(t){console.error("Failed to fetch services",t)}finally{let t;return t=setTimeout(()=>{o(!1),m("Next")},1e3),()=>clearTimeout(t)}}},T=t=>{const r=String(Math.floor(t/3600)).padStart(2,"0"),g=String(Math.floor(t%3600/60)).padStart(2,"0"),v=String(t%60).padStart(2,"0");return`${r}:${g}:${v}`};return n.useEffect(()=>{C();const t=new WebSocket("ws://192.168.3.46:8080");return N.current=t,t.addEventListener("open",()=>{console.log("Connected to WS server")}),t.addEventListener("message",r=>{try{const g=JSON.parse(r.data);g.event==="new-ticket"?(console.log("Received new-ticket event:",g),C()):console.log("Received other event:",g)}catch{console.error("Failed to parse message:",r.data)}}),t.addEventListener("error",r=>{console.error("WebSocket error:",r)}),()=>{t.close()}},[]),n.useEffect(()=>{let t;return j&&b!==null?t=setInterval(()=>{const r=Date.now(),g=Math.floor((r-b)/1e3);S(w+g)},1e3):S(w),()=>clearInterval(t)},[j,b,w]),e.jsxs("div",{className:"flex h-full w-full px-15 text-gray-800 dark:bg-gray-900 dark:text-gray-900",children:[e.jsxs("div",{className:"flex w-1/2 flex-col justify-center",children:[e.jsx("div",{children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("h2",{className:"mb-2 text-lg font-medium text-orange-600 dark:text-orange-400",children:"Current Serving"}),e.jsx("h1",{className:"mb-4 text-2xl font-bold text-blue-900 dark:text-blue-300",children:"Token Number"}),e.jsx("div",{className:"w-fit rounded-xl border-2 border-orange-500 px-12 py-6 text-[64px] font-bold text-orange-600 dark:border-orange-400 dark:text-orange-400",children:(a==null?void 0:a.token_number_display)??"---"}),e.jsxs("div",{className:"mt-6 text-center",children:[e.jsx("p",{className:"mb-1 text-sm text-gray-500 dark:text-gray-400",children:"Serving Time"}),e.jsxs("p",{className:"text-3xl font-bold text-blue-900 dark:text-blue-300",children:[" ",T(F)]})]})]})}),e.jsxs("div",{className:"mt-8 flex justify-between text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"mb-1 text-lg font-medium text-gray-500 dark:text-gray-400",children:"Total Served Tokens"}),e.jsx("p",{className:"text-xl font-bold text-blue-900 dark:text-blue-300",children:d==null?void 0:d.served})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-1 text-lg font-medium text-gray-500 dark:text-gray-400",children:"Total Pending"}),e.jsx("p",{className:"text-xl font-bold text-orange-600 dark:text-orange-400",children:d==null?void 0:d.pending})]})]})]}),e.jsx("div",{className:"mx-4 w-px bg-gray-300 dark:bg-gray-600"}),e.jsxs("div",{className:"flex h-full w-1/2 flex-col justify-center px-15",children:[e.jsxs("div",{className:"mb-10 flex flex-wrap gap-6 lg:flex-nowrap",children:[e.jsxs("div",{className:"w-full rounded-xl p-6 lg:w-3/2",children:[e.jsx("h2",{className:"mb-4 text-xl font-semibold text-blue-900 dark:text-blue-300",children:"Profile Info"}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-700 dark:text-gray-300",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-500 dark:text-gray-400",children:"Name:"})," ",M.name]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-500 dark:text-gray-400",children:"Email:"})," ",M.email]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-medium text-gray-500 dark:text-gray-400",children:"Service:"}),e.jsx("div",{children:e.jsx(ge,{})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-medium text-gray-500 dark:text-gray-400",children:"Counter:"}),e.jsx(me,{})]})]})]}),e.jsxs("div",{className:"w-full rounded-xl p-6 lg:w-1/3",children:[e.jsx("h2",{className:"mb-4 text-xl font-semibold text-blue-900 dark:text-blue-300",children:"Performance"}),e.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:e.jsx("span",{className:"font-medium text-orange-600 dark:text-orange-400",children:e.jsx("b",{children:A})})})]})]}),e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx(p,{onClick:Q,className:"w-1/2 rounded-lg bg-indigo-500 p-6 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:u}),e.jsx(p,{onClick:G,className:"w-1/2 rounded-lg bg-indigo-500 p-6 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:"End"}),e.jsx(p,{onClick:K,className:"w-1/2 rounded-lg bg-indigo-500 p-6 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:"No Show"}),e.jsx(p,{onClick:J,className:"w-1/2 rounded-lg bg-indigo-500 p-6 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:s}),e.jsx(he,{title:"Manual Call",onSubmitData:B}),e.jsx(p,{onClick:H,className:"w-1/2 rounded-lg bg-indigo-500 p-6 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:j?"Resume":"Pause"})]})]})]})};function be(){const[l,d]=n.useState([]),[i,a]=n.useState({current_page:1,last_page:1,total:0}),[x,h]=n.useState(!0),o=async(u=1)=>{try{h(!0);const s=await(await fetch(`/login-logs?page=${u}`)).json();d(s.data),a({current_page:s.current_page,last_page:s.last_page,total:s.total})}catch(m){console.error("Failed to fetch login logs",m)}finally{h(!1)}};return n.useEffect(()=>{o()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4 font-bold",children:"Login History"}),e.jsxs(re,{children:[e.jsx(ae,{children:e.jsxs(E,{children:[e.jsx(R,{children:"Date"}),e.jsx(R,{children:"IP Address"})]})}),e.jsx(ne,{children:l.length?l.map((u,m)=>e.jsxs(E,{children:[e.jsx(P,{children:u.formatted_logged_in_at}),e.jsx(P,{children:u.ip_address})]},m)):e.jsx(E,{children:e.jsx(P,{colSpan:3,className:"py-6 text-center",children:x?"Loading...":"No login records found."})})})]}),e.jsxs("div",{className:"mt-4 flex justify-between",children:[e.jsxs("div",{children:["Page ",i.current_page," of ",i.last_page]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx(p,{variant:"outline",disabled:i.current_page===1,onClick:()=>o(i.current_page-1),children:"Previous"}),e.jsx(p,{variant:"outline",disabled:i.current_page===i.last_page,onClick:()=>o(i.current_page+1),children:"Next"})]})]})]})}const fe=[{title:"Dashboard",href:"/dashboard"}];function De(){var u,m;const{auth:l}=W().props,d=[{title:"Total Visits Today",value:"320",icon:e.jsx(X,{className:"h-8 w-8 text-blue-500"})},{title:"Total in Queue",value:"22",icon:e.jsx(de,{className:"h-8 w-8 text-yellow-500"})},{title:"VIP Customers",value:"8",icon:e.jsx(xe,{className:"h-8 w-8 text-purple-500"})},{title:"Avg. Wait Time",value:"5 min",icon:e.jsx(oe,{className:"h-8 w-8 text-green-500"})}],[i,a]=n.useState([]),x=async()=>{try{const c=await(await fetch("/tokens")).json();console.log("ðŸš€ ~ fetchTokenCounts ~ json:",c),a(c.data)}catch(s){console.error("Failed to fetch services",s)}};n.useEffect(()=>{x()},[]);const h=[{ticket:"V001",name:"Mr. Khan",counter:"1",status:"Serving"},{ticket:"V002",name:"Dr. Ayesha",counter:"VIP Lounge",status:"Waiting"}],o=[{name:"Counter A",ticket:"A101",status:"Serving"},{name:"Counter B",ticket:"B205",status:"Idle"},{name:"Counter C",ticket:"C309",status:"Serving"}];return e.jsxs(I,{breadcrumbs:fe,children:[e.jsx(z,{title:"Queue Management Dashboard"}),((u=l==null?void 0:l.user)==null?void 0:u.type)==="master"&&e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 p-4",children:[e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 xl:grid-cols-4",children:d.map((s,c)=>e.jsxs("div",{className:"flex items-center justify-between rounded-xl border p-4 shadow-sm dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:s.title}),e.jsx("p",{className:"mt-2 text-2xl font-semibold text-gray-900 dark:text-white",children:s.value})]}),e.jsx("div",{className:"ml-4",children:s.icon})]},c))}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"h-80 overflow-auto rounded-xl border border-gray-200 bg-[var(--background)] p-4 text-[var(--foreground)] dark:border-gray-700",children:[e.jsx("h3",{className:"mb-4 text-lg font-semibold text-gray-800 dark:text-white",children:"Regular Customers"}),e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 text-left dark:border-gray-700",children:[e.jsx("th",{className:"p-2 font-medium",children:"Ticket No."}),e.jsx("th",{className:"p-2 font-medium",children:"Counter"})]})}),e.jsx("tbody",{children:i.map((s,c)=>{var b;return e.jsxs("tr",{className:"border-t border-gray-200 dark:border-gray-700",children:[e.jsx("td",{className:"p-2 font-mono",children:s==null?void 0:s.token_number_display}),e.jsxs("td",{className:"p-2",children:["Counter ",(b=s==null?void 0:s.counter)==null?void 0:b.name]})]},c)})})]})]}),e.jsxs("div",{className:"h-80 overflow-auto rounded-xl border border-gray-200 bg-[var(--background)] p-4 text-[var(--foreground)] dark:border-gray-700",children:[e.jsx("h3",{className:"mb-4 text-lg font-semibold text-gray-800 dark:text-white",children:"VIP Customers"}),e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 text-left dark:border-gray-700",children:[e.jsx("th",{className:"p-2 font-medium",children:"Ticket No."}),e.jsx("th",{className:"p-2 font-medium",children:"Name"}),e.jsx("th",{className:"p-2 font-medium",children:"Counter"}),e.jsx("th",{className:"p-2 font-medium",children:"Status"})]})}),e.jsx("tbody",{children:h.map((s,c)=>e.jsxs("tr",{className:"border-t border-gray-200 dark:border-gray-700",children:[e.jsx("td",{className:"p-2 font-mono",children:s.ticket}),e.jsx("td",{className:"p-2",children:s.name}),e.jsx("td",{className:"p-2",children:s.counter}),e.jsx("td",{className:"p-2",children:e.jsx("span",{className:`inline-block rounded px-2 py-1 text-xs font-semibold ${s.status==="Serving"?"bg-green-100 text-green-800 dark:bg-green-800/30 dark:text-green-300":"bg-yellow-100 text-yellow-800 dark:bg-yellow-800/30 dark:text-yellow-300"}`,children:s.status})})]},c))})]})]}),e.jsxs("div",{className:"h-80 overflow-auto rounded-xl border border-gray-200 bg-[var(--background)] p-4 text-[var(--foreground)] dark:border-gray-700",children:[e.jsx("h3",{className:"mb-4 text-lg font-semibold text-gray-800 dark:text-white",children:"Counters"}),e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 text-left dark:border-gray-700",children:[e.jsx("th",{className:"p-2 font-medium",children:"Counter"}),e.jsx("th",{className:"p-2 font-medium",children:"Ticket No."}),e.jsx("th",{className:"p-2 font-medium",children:"Status"})]})}),e.jsx("tbody",{children:o.map((s,c)=>e.jsxs("tr",{className:"border-t border-gray-200 dark:border-gray-700",children:[e.jsx("td",{className:"p-2",children:s.name}),e.jsx("td",{className:"p-2 font-mono",children:s.ticket}),e.jsx("td",{className:"p-2",children:e.jsx("span",{className:`inline-block rounded px-2 py-1 text-xs font-semibold ${s.status==="Serving"?"bg-green-100 text-green-800 dark:bg-green-800/30 dark:text-green-300":"bg-yellow-100 text-yellow-800 dark:bg-yellow-800/30 dark:text-yellow-300"}`,children:s.status})})]},c))})]})]}),e.jsxs("div",{className:"h-80 overflow-auto rounded-xl border border-gray-200 bg-[var(--background)] p-4 text-[var(--foreground)] dark:border-gray-700",children:[e.jsx("h3",{className:"mb-4 text-lg font-semibold text-gray-800 dark:text-white",children:"Counters"}),e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 text-left dark:border-gray-700",children:[e.jsx("th",{className:"p-2 font-medium",children:"Counter"}),e.jsx("th",{className:"p-2 font-medium",children:"Ticket No."}),e.jsx("th",{className:"p-2 font-medium",children:"Status"})]})}),e.jsx("tbody",{children:o.map((s,c)=>e.jsxs("tr",{className:"border-t border-gray-200 dark:border-gray-700",children:[e.jsx("td",{className:"p-2",children:s.name}),e.jsx("td",{className:"p-2 font-mono",children:s.ticket}),e.jsx("td",{className:"p-2",children:e.jsx("span",{className:`inline-block rounded px-2 py-1 text-xs font-semibold ${s.status==="Serving"?"bg-green-100 text-green-800 dark:bg-green-800/30 dark:text-green-300":"bg-yellow-100 text-yellow-800 dark:bg-yellow-800/30 dark:text-yellow-300"}`,children:s.status})})]},c))})]})]}),e.jsx("div",{className:"w-full rounded-lg border border-gray-100 bg-[var(--background)] p-4 p-6 text-[var(--foreground)] shadow dark:border-gray-700 dark:bg-gray-900",children:e.jsx(be,{})})]})]}),((m=l==null?void 0:l.user)==null?void 0:m.type)==="user"&&e.jsx(ue,{})]})}export{De as default};
