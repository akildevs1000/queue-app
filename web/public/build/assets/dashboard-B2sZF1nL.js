import{r as s,m as de,j as e,K as B,L as ge}from"./app-C0323dSE.js";import{U as xe,A as ue}from"./app-layout-DCqIq2Ql.js";import{B as L}from"./button-qxJnuGv1.js";import{G as D}from"./GradientButton-D6CkIx1E.js";import{D as he,a as me,b as fe}from"./dialog-DPxlWTlw.js";import{I as pe}from"./input-9mHWVFj7.js";import{T as V,a as G,b as P,c as M,d as H,e as E,u as be,f as J,i as ye,j as je}from"./table-CpH-GJYd.js";import{R as Q,B as Y,X as I,Y as X,T as q,L as Z,a as ee}from"./BarChart-DHzGotaB.js";import{S as ve,a as ke,b as Se,c as we,f as Ne}from"./select-CCbDqpjw.js";import{C as _e}from"./index-D8CUWrj_.js";import{c as te}from"./app-logo-icon-Bf2wZ0zl.js";import"./utils-jAU0Cazi.js";import"./index-BOWObJjw.js";import"./index-Bj03YIKp.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],Te=te("Activity",Ce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],U=te("Clock",De);function Pe({title:n,onSubmitData:o}){const[d,a]=s.useState(!1),{data:c,setData:u,processing:i}=de({token_number_display:""}),f=l=>{l.preventDefault(),o(c.token_number_display),a(!1),u("token_number_display","")};return e.jsxs(he,{open:d,onOpenChange:a,children:[e.jsx(me,{asChild:!0,children:e.jsx(D,{className:"rounded-lg p-7 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:n})}),e.jsxs(fe,{children:[e.jsx("h2",{className:"text-xl font-bold",children:n}),e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsx("div",{className:"max-w-md",children:e.jsx(pe,{placeholder:"Token",type:"text",value:c.token_number_display,onChange:l=>u("token_number_display",l.target.value)})}),e.jsx(L,{className:"w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white",type:"submit",disabled:i,children:"Call"})]})]})]})}const Le=()=>{const{auth:n}=B().props,[o,d]=s.useState(null),[a,c]=s.useState(null),[u,i]=s.useState(!1),[f,l]=s.useState("Next"),[m,v]=s.useState("Recall"),[y,N]=s.useState(null),[R,p]=s.useState(null),[x,g]=s.useState(!1),[C,_]=s.useState(0),[O,w]=s.useState(0),[k,$]=s.useState(null),T=s.useRef(null);n.user;const A=async()=>{try{const t=await(await fetch("/token-counts")).json();d(t)}catch(r){console.error("Failed to fetch services",r)}},ae=async r=>{try{let h=await(await fetch(`/manual-call/${r}`)).json();if(!(h!=null&&h.id))return;c(h),N(Date.now()),g(!0);const b=await(await fetch(`/start-serving/${h.id}`)).json();if(b&&b.counter){const S=T.current;if(S&&S.readyState===WebSocket.OPEN){const K={event:"token-serving",data:b};$(K),S.send(JSON.stringify(K)),S.send(JSON.stringify({event:"feedback",data:{counter_id:(counter==null?void 0:counter.id)||0,token_id:h.id,...b}}))}else console.warn("WebSocket is not open.")}}catch(t){console.error("Failed to fetch services",t)}},se=async()=>{if(!(a!=null&&a.token_number_display))return;v(`Recalling ${a==null?void 0:a.token_number_display}`),i(!0);const r=T.current;r&&r.readyState===WebSocket.OPEN?(console.log("🚀 ~ reCall ~ announcerPayload:",k),r.send(JSON.stringify(k))):console.warn("WebSocket is not open.");let t;return t=setTimeout(()=>{i(!1),v("Recall")},5e3),()=>clearTimeout(t)},re=()=>{if(x&&y!==null){const r=Date.now(),t=Math.floor((r-y)/1e3);_(h=>h+t),N(null),g(!1)}},ne=()=>{!x&&a&&(N(Date.now()),g(!0))},oe=()=>{x?re():ne()},le=async()=>{if(!(a!=null&&a.token_number_display))return;let r=C;if(x&&y!==null){const t=Date.now();r+=Math.floor((t-y)/1e3)}console.log("Total time served:",F(r));try{if(await fetch(`/end-serving/${a==null?void 0:a.id}?total_serving_time_display=${F(r)}`),_(0),N(null),g(!1),w(0),c(null),!(k!=null&&k.data))return;const t=T.current;if((t==null?void 0:t.readyState)===WebSocket.OPEN){const h={event:"token-serving-end",data:k.data};console.log("🚀 Sending token-serving-end event:",h),t.send(JSON.stringify(h)),A()}else console.warn("⚠️ WebSocket is not open.")}catch(t){console.error("Failed to fetch services",t)}},ie=async()=>{if(!(k!=null&&k.data))return;const r=T.current;if((r==null?void 0:r.readyState)===WebSocket.OPEN){const t={event:"token-serving-end",data:k.data};console.log("🚀 Sending token-serving-end event:",t),r.send(JSON.stringify(t))}else console.warn("⚠️ WebSocket is not open.");try{await fetch(`/no-show-serving/${a==null?void 0:a.id}`),_(0),N(null),g(!1),w(0),c(null)}catch(t){console.error("Failed to fetch services",t)}},ce=async()=>{if(!(a!=null&&a.token_number_display)){i(!0),l("Calling Next");try{let t=await(await fetch("/next-token")).json();if(!(t!=null&&t.id))return;c(t),N(Date.now()),g(!0);const j=await(await fetch(`/start-serving/${t.id}`)).json();if(j&&j.counter){const b=T.current;if(b&&b.readyState===WebSocket.OPEN){const S={event:"token-serving",data:j};console.log("🚀 ~ nextToken ~ socketPacket:",S),$(S),b.send(JSON.stringify(S)),b.send(JSON.stringify({event:"feedback",data:{counter_id:(counter==null?void 0:counter.id)||0,token_id:t.id,...j}}))}else console.warn("WebSocket is not open.")}}catch(r){console.error("Failed to fetch services",r)}finally{let r;return r=setTimeout(()=>{i(!1),l("Next")},1e3),()=>clearTimeout(r)}}},F=r=>{const t=String(Math.floor(r/3600)).padStart(2,"0"),h=String(Math.floor(r%3600/60)).padStart(2,"0"),j=String(r%60).padStart(2,"0");return`${t}:${h}:${j}`},W=async()=>{const t=await(await fetch("/socket-ip-and-port")).json();if(!(t!=null&&t.ip)||!(t!=null&&t.port)){console.log("🚀 ~ handleSocketConnect ~ auth?.user:",n==null?void 0:n.user),p("Socket not connected");return}p(null);let h=`ws://${t.ip}:${t.port}`;const j=new WebSocket(h);return T.current=j,j.addEventListener("open",()=>{console.log("Connected to WS server")}),j.addEventListener("message",b=>{try{const S=JSON.parse(b.data);S.event==="new-ticket"&&(console.log("Received new-ticket event:",S),A())}catch{console.error("Failed to parse message:",b.data)}}),j.addEventListener("error",b=>{console.error("WebSocket error:",b)}),()=>{j.close()}};return s.useEffect(()=>{W(),A()},[]),s.useEffect(()=>{let r;return x&&y!==null?r=setInterval(()=>{const t=Date.now(),h=Math.floor((t-y)/1e3);w(C+h)},1e3):w(C),()=>clearInterval(r)},[x,y,C]),e.jsxs("div",{className:"flex h-full w-full px-15 text-gray-800 dark:bg-gray-900 dark:text-gray-900",children:[e.jsxs("div",{className:"mt-10 flex w-1/2 flex-col",children:[e.jsx("div",{children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("h2",{className:"mb-2 text-lg font-medium text-orange-600 dark:text-orange-400",children:"Current Serving"}),e.jsx("h1",{className:"mb-2 text-2xl font-bold text-blue-900 dark:text-blue-300",children:"Token Number"}),e.jsx("div",{className:"w-fit rounded-xl border-2 border-orange-500 px-12 text-[64px] font-bold text-orange-600 dark:border-orange-400 dark:text-orange-400",children:(a==null?void 0:a.token_number_display)??"---"}),e.jsxs("div",{className:"mt-6 text-center",children:[e.jsx("p",{className:"mb-1 text-sm text-gray-500 dark:text-gray-400",children:"Serving Time"}),e.jsxs("p",{className:"text-3xl font-bold text-blue-900 dark:text-blue-300",children:[" ",F(O)]})]})]})}),e.jsxs("div",{className:"mt-8 flex justify-between text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"mb-1 text-lg font-medium text-gray-500 dark:text-gray-400",children:"Total Served Tokens"}),e.jsx("p",{className:"text-xl font-bold text-blue-900 dark:text-blue-300",children:o==null?void 0:o.served})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-1 text-lg font-medium text-gray-500 dark:text-gray-400",children:"Total Pending"}),e.jsx("p",{className:"text-xl font-bold text-orange-600 dark:text-orange-400",children:o==null?void 0:o.pending})]})]})]}),e.jsx("div",{className:"mx-4 w-px bg-gray-300 dark:bg-gray-600"}),e.jsxs("div",{className:"flex h-full w-1/2 flex-col justify-center px-15",children:[R&&e.jsx("div",{className:"mb-4 flex w-full justify-center",children:e.jsxs(L,{onClick:()=>{W()},className:"rounded-lg bg-orange-500 p-6 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:[R," Reconnect"]})}),!R&&e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex flex-col items-center space-y-4",children:e.jsxs("div",{className:"grid w-full max-w-xl grid-cols-2 gap-3",children:[e.jsx(D,{onClick:ce,className:"rounded-lg p-7 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:f}),e.jsx(D,{onClick:le,className:"rounded-lg p-7 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:"End"}),e.jsx(D,{onClick:ie,className:"rounded-lg p-7 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:"No Show"}),e.jsx(D,{onClick:se,className:"rounded-lg p-7 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:m}),e.jsx(D,{onClick:oe,className:"rounded-lg p-7 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:x?"Resume":"Pause"}),e.jsx(Pe,{title:"Manual Call",onSubmitData:ae})]})})})]})]})};function Re(){const[n,o]=s.useState([]),[d,a]=s.useState({current_page:1,last_page:1,total:0}),[c,u]=s.useState(!0),i=async(f=1)=>{try{u(!0);const m=await(await fetch(`/login-logs?page=${f}`)).json();o(m.data),a({current_page:m.current_page,last_page:m.last_page,total:m.total})}catch(l){console.error("Failed to fetch login logs",l)}finally{u(!1)}};return s.useEffect(()=>{i()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4 font-bold",children:"Login History"}),e.jsxs(V,{children:[e.jsx(G,{children:e.jsxs(P,{children:[e.jsx(M,{children:"Date"}),e.jsx(M,{children:"IP Address"})]})}),e.jsx(H,{children:n.length?n.map((f,l)=>e.jsxs(P,{children:[e.jsx(E,{children:f.formatted_logged_in_at}),e.jsx(E,{children:f.ip_address})]},l)):e.jsx(P,{children:e.jsx(E,{colSpan:3,className:"py-6 text-center",children:c?"Loading...":"No login records found."})})})]}),e.jsxs("div",{className:"mt-4 flex justify-between",children:[e.jsxs("div",{children:["Page ",d.current_page," of ",d.last_page]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx(L,{variant:"outline",disabled:d.current_page===1,onClick:()=>i(d.current_page-1),children:"Previous"}),e.jsx(L,{variant:"outline",disabled:d.current_page===d.last_page,onClick:()=>i(d.current_page+1),children:"Next"})]})]})]})}function Ee(){const[n,o]=s.useState([]),[d,a]=s.useState([]),c=["#8884d8","#82ca9d","#ffc658","#ff7f50","#a569bd","#f4d03f","#5dade2","#48c9b0"];return s.useEffect(()=>{(async()=>{try{const i=new URL("/peak-day-report",window.location.origin),l=await(await fetch(i.toString())).json();if(o(l),l.length){const m=Object.keys(l[0]).filter(v=>v!=="date");a(m)}}catch(i){console.error("Failed to fetch data:",i)}})()},[]),e.jsx("div",{className:"flex flex-1 flex-col gap-4 rounded-xl p-4",children:e.jsxs("div",{className:"gap-4 rounded-xl bg-[var(--background)] p-1 text-[var(--foreground)] dark:border-gray-700",children:[e.jsx("h2",{className:"mb-4 text-lg font-semibold",children:"Peak Day (Last Week)"}),e.jsxs("div",{children:[e.jsx("h3",{style:{textAlign:"center"},children:"Queue Flow (to identify peak Day)"}),e.jsx(Q,{height:300,children:e.jsxs(Y,{data:n,margin:{top:20,right:50,left:50},barCategoryGap:10,barGap:1,children:[e.jsx(I,{dataKey:"date"}),e.jsx(X,{label:{value:"Number Of Token",angle:-90,position:"insideLeft",offset:10}}),e.jsx(q,{}),e.jsx(Z,{}),d.map((u,i)=>e.jsx(ee,{dataKey:u,fill:c[i%c.length],barSize:5},u))]})})]})]})})}function Ae(){const[n,o]=s.useState([]),[d,a]=s.useState([]),c=["#8884d8","#82ca9d","#ffc658","#ff7f50","#a569bd","#f4d03f","#5dade2","#48c9b0"];return s.useEffect(()=>{(async()=>{try{const i=new URL("/peak-hour-report",window.location.origin),l=await(await fetch(i.toString())).json();if(o(l),l.length>0){const m=l[0],v=Object.keys(m).filter(y=>y!=="time");a(v)}}catch(i){console.error("Failed to fetch data:",i)}})()},[]),e.jsx("div",{className:"flex flex-1 flex-col gap-4 rounded-xl p-4",children:e.jsxs("div",{className:"gap-4 rounded-xl bg-[var(--background)] p-1 text-[var(--foreground)] dark:border-gray-700",children:[e.jsx("h2",{className:"mb-4 text-lg font-semibold",children:"Peak Hours (Yesterday)"}),e.jsxs("div",{children:[e.jsx("h3",{style:{textAlign:"center"},children:"Queue Flow (to identify peak Day)"}),e.jsx(Q,{height:300,children:e.jsxs(Y,{data:n,margin:{top:20,right:50,left:50},barCategoryGap:10,barGap:1,children:[e.jsx(I,{dataKey:"time"}),e.jsx(X,{label:{value:"Number Of Token",angle:-90,position:"insideLeft",offset:10}}),e.jsx(q,{}),e.jsx(Z,{}),d.map((u,i)=>e.jsx(ee,{dataKey:u,fill:c[i%c.length],barSize:5},u))]})})]})]})})}const z=[{cell:({row:n})=>n.index+1,header:"#"},{accessorKey:"service.name",header:"Service",id:"serviceName"},{accessorKey:"token_number_display",header:"Token"},{accessorKey:"counter.name",header:"Counter",id:"counterName"},{accessorKey:"user.name",header:"User"},{accessorKey:"language",header:"Language"},{accessorKey:"status",header:"Status",cell:({getValue:n})=>{const o={0:"Pending",1:"Not Answered",2:"Serving",3:"Served"},d=n(),a=o[d]||"Unknown Status";let c="inline-block rounded px-2 py-1 text-xs font-semibold";switch(d){case"2":c+=" bg-green-100 text-green-800 dark:bg-green-800/30 dark:text-green-300";break;case"3":c+=" bg-blue-100 text-blue-800 dark:bg-blue-800/30 dark:text-blue-300";break;case"0":c+=" bg-yellow-100 text-yellow-800 dark:bg-yellow-800/30 dark:text-yellow-300";break;case"1":c+=" bg-red-100 text-red-800 dark:bg-red-800/30 dark:text-red-300";break;default:c+=" bg-gray-100 text-gray-800 dark:bg-gray-800/30 dark:text-gray-300";break}return e.jsx("span",{className:c,children:a})}},{accessorKey:"total_serving_time_display",header:"Serving Time",cell:({getValue:n})=>{const o=n();return o===null?"---":o}},{accessorKey:"created_at_formatted",header:"Date Time"}];function Fe(){const[n,o]=s.useState([]),[d,a]=s.useState([]),[c,u]=s.useState({}),[i,f]=s.useState({}),[l,m]=s.useState([]),[v,y]=s.useState({pageIndex:0,pageSize:10}),[N,R]=s.useState(0),p=be({data:l,columns:z,state:{sorting:n,columnFilters:d,columnVisibility:c,rowSelection:i,pagination:v},onSortingChange:o,onColumnFiltersChange:a,onColumnVisibilityChange:u,onRowSelectionChange:f,onPaginationChange:y,manualPagination:!0,pageCount:N,getCoreRowModel:je(),getPaginationRowModel:ye()});return s.useEffect(()=>{(async()=>{try{const g=v.pageIndex+1,C=v.pageSize,_=new URL("/get-report-data",window.location.origin);_.searchParams.append("page",g.toString()),_.searchParams.append("per_page",C.toString());const w=await(await fetch(_.toString())).json();m(w.data),R(w.last_page),w.current_page!==g&&y(k=>({...k,pageIndex:w.current_page-1}))}catch(g){console.error("Failed to fetch tokens:",g)}})()},[v.pageIndex,v.pageSize]),e.jsxs(e.Fragment,{children:[e.jsxs(V,{children:[e.jsx(G,{children:p.getHeaderGroups().map(x=>e.jsx(P,{children:x.headers.map(g=>e.jsx(M,{children:g.isPlaceholder?null:J(g.column.columnDef.header,g.getContext())},g.id))},x.id))}),e.jsx(H,{children:p.getRowModel().rows.length?p.getRowModel().rows.map(x=>e.jsx(P,{children:x.getVisibleCells().map(g=>e.jsx(E,{children:J(g.column.columnDef.cell,g.getContext())},g.id))},x.id)):e.jsx(P,{children:e.jsx(E,{colSpan:z.length,className:"h-24 text-center",children:"No results."})})})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"Rows per page:"}),e.jsxs(ve,{value:String(p.getState().pagination.pageSize),onValueChange:x=>{p.setPageSize(Number(x)),y(g=>({...g,pageIndex:0,pageSize:Number(x)}))},children:[e.jsx(ke,{className:"w-[100px]",children:e.jsx(Se,{})}),e.jsx(we,{children:[5,10,20,50,100].map(x=>e.jsx(Ne,{value:String(x),children:x},x))})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{variant:"outline",onClick:()=>p.previousPage(),disabled:!p.getCanPreviousPage(),children:"Previous"}),e.jsxs("span",{children:["Page ",p.getState().pagination.pageIndex+1," of ",p.getPageCount()]}),e.jsx(L,{variant:"outline",onClick:()=>p.nextPage(),disabled:!p.getCanNextPage(),children:"Next"})]})]})]})}const Me=[{title:"Dashboard",href:"/dashboard"}];function Xe({items:n}){var i,f;console.log("🚀 ~ Dashboard ~ items:",n);const{auth:o}=B().props,d=[{title:"Total Visits Today",value:n.total_visits,icon:e.jsx(xe,{className:"h-8 w-8 text-blue-500"})},{title:"Total in Served",value:n.served,icon:e.jsx(_e,{className:"h-8 w-8 text-green-500"})},{title:"Total in Serving",value:n.serving,icon:e.jsx(U,{className:"h-8 w-8 text-blue-500"})},{title:"Total in Queue",value:n.pending,icon:e.jsx(U,{className:"h-8 w-8 text-yellow-500"})},{title:"Avg. Wait Time",value:`${n.avgTimeInMinutes} Min`,icon:e.jsx(Te,{className:"h-8 w-8 text-green-500"})}],[a,c]=s.useState([]),u=async()=>{try{const m=await(await fetch("/tokens")).json();console.log("🚀 ~ fetchTokenCounts ~ json:",m),c(m.data)}catch(l){console.error("Failed to fetch services",l)}};return s.useEffect(()=>{u()},[]),e.jsxs(ue,{breadcrumbs:Me,children:[e.jsx(ge,{title:"Queue Management Dashboard"}),((i=o==null?void 0:o.user)==null?void 0:i.type)==="master"&&e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 p-4",children:[e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 xl:grid-cols-5",children:d.map((l,m)=>e.jsxs("div",{className:"flex items-center justify-between rounded-xl border p-4 shadow-sm dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:l.title}),e.jsx("p",{className:"mt-2 text-2xl font-semibold text-gray-900 dark:text-white",children:l.value})]}),e.jsx("div",{className:"ml-4",children:l.icon})]},m))}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx("div",{className:"rounded-xl border border-gray-200 bg-[var(--background)] p-4 text-[var(--foreground)] dark:border-gray-700",children:e.jsx(Ee,{})}),e.jsx("div",{className:"rounded-xl border border-gray-200 bg-[var(--background)] p-4 text-[var(--foreground)] dark:border-gray-700",children:e.jsx(Ae,{})})]}),e.jsx("div",{className:"rounded-xl border border-gray-200 bg-[var(--background)] p-4 text-[var(--foreground)] dark:border-gray-700",children:e.jsx(Fe,{})}),e.jsx("div",{className:"w-full rounded-lg border border-gray-100 bg-[var(--background)] p-4 p-6 text-[var(--foreground)] shadow dark:border-gray-700 dark:bg-gray-900",children:e.jsx(Re,{})})]}),((f=o==null?void 0:o.user)==null?void 0:f.type)==="user"&&e.jsx(Le,{})]})}export{Xe as default};
