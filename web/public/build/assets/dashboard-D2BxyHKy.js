import{r,j as e,m as q,K as M,L as z}from"./app-Bt5uBVhc.js";import{A as J,U as X}from"./app-layout-k-we6VR-.js";import{B as f}from"./button-5gN7GO5e.js";import{D as Y,a as Z,b as ee}from"./dialog-DyyGfPt9.js";import{G as te}from"./GradientButton-J7rzLSO0.js";import{I as se}from"./input-Dmh7QavN.js";import{T as ae,a as re,b as _,c as F,d as ne,e as T}from"./table-Bzi60CZn.js";import{c as C}from"./app-logo-icon-BSYv3gaP.js";import"./utils-jAU0Cazi.js";import"./index-BZHP9Xdv.js";import"./index-Cks5Wvhg.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],oe=C("Activity",le);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],ce=C("Clock",ie);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]],xe=C("UserCheck",de);function me(){const[l,i]=r.useState(null),[c,a]=r.useState(!0),m=async()=>{try{a(!0);const o=await(await fetch("/counter-by-user")).json();console.log("ðŸš€ ~ fetchLastLogin ~ json:",o),i(o)}catch(x){console.error("Failed to fetch last login",x)}finally{a(!1)}};return r.useEffect(()=>{m()},[]),e.jsx("div",{className:"",children:c?e.jsx("p",{className:"text-gray-500",children:"Loading..."}):l?e.jsx("div",{className:"space-y-2 text-sm",children:e.jsxs("p",{children:[" ",l.name]})}):e.jsx("p",{className:"text-gray-500",children:"---"})})}function ge(){const[l,i]=r.useState(null),[c,a]=r.useState(!0),m=async()=>{try{a(!0);const o=await(await fetch("/service-by-user")).json();console.log("ðŸš€ ~ fetchLastLogin ~ json:",o),i(o)}catch(x){console.error("Failed to fetch last login",x)}finally{a(!1)}};return r.useEffect(()=>{m()},[]),e.jsx("div",{className:"",children:c?e.jsx("p",{className:"text-gray-500",children:"Loading..."}):l?e.jsx("div",{className:"space-y-2 text-sm",children:e.jsxs("p",{children:[" ",l.name]})}):e.jsx("p",{className:"text-gray-500",children:"No login record found."})})}function he({title:l,endpoint:i}){const[c,a]=r.useState(!1),{data:m,setData:x,processing:o,errors:g}=q({token_number_display:""}),h=t=>{t.preventDefault(),console.log("ðŸš€ ~ handleSubmit ~ token_number_display:",m.token_number_display)};return e.jsxs(Y,{open:c,onOpenChange:a,children:[e.jsx(Z,{asChild:!0,children:e.jsx(te,{className:"w-1/2 rounded-lg bg-indigo-500 p-6 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:l})}),e.jsxs(ee,{children:[e.jsx("h2",{className:"text-xl font-bold",children:l}),e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{className:"max-w-md",children:[e.jsx(se,{placeholder:"Token",type:"text",value:m.token_number_display,onChange:t=>x("token_number_display",t.target.value)}),g.token_number_display&&e.jsx("p",{className:"pt-1 pl-1 text-sm text-red-400",children:g.token_number_display})]}),e.jsx(f,{className:"w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white",type:"submit",disabled:o,children:o?"Submitting...":"Submit"})]})]})]})}const ue=()=>{const{auth:l}=M().props,[i,c]=r.useState(null),[a,m]=r.useState(null),[x,o]=r.useState(!1),[g,h]=r.useState("Next"),[t,d]=r.useState("Recall"),[u,y]=r.useState(null),[A,B]=r.useState(null),[p,N]=r.useState(!1),[pe,L]=r.useState(!1),[k,w]=r.useState(0),[R,v]=r.useState(0),D=l.user||{name:"John Doe",email:"john@example.com"},E=async()=>{try{const n=await(await fetch("/token-counts")).json();c(n)}catch(s){console.error("Failed to fetch services",s)}},U=async()=>{try{const n=await(await fetch("/feedback-by-counter")).json();B(n)}catch(s){console.error("Failed to fetch services",s)}};r.useEffect(()=>{const s=setInterval(()=>{U()},5e3);return()=>clearInterval(s)},[]);const P=s=>{const n=s==null?void 0:s.token_number_display;if(n){const b=`Token ${n}, please proceed to the counter.`;console.log(b);const j=new SpeechSynthesisUtterance(b);j.lang="en-US",speechSynthesis.speak(j)}else console.warn("No token information available to announce.")},I=async()=>{if(!(a!=null&&a.token_number_display))return;d(`Recalling ${a==null?void 0:a.token_number_display}`),P(a),o(!0);let s;return s=setTimeout(()=>{o(!1),d("Recall")},5e3),()=>clearTimeout(s)},V=()=>{if(p&&u!==null){const s=Date.now(),n=Math.floor((s-u)/1e3);w(b=>b+n),y(null),N(!1)}},H=()=>{!p&&a&&(y(Date.now()),N(!0))},G=()=>{p?V():H()},$=()=>i!=null&&i.pending?!1:(console.log("Not found new token"),!0),K=async()=>{if($())return;let s=k;if(p&&u!==null){const n=Date.now();s+=Math.floor((n-u)/1e3)}console.log("Total time served:",S(s));try{await fetch(`/end-serving/${a==null?void 0:a.id}?total_serving_time_display=${S(s)}`),w(0),y(null),N(!1),v(0)}catch(n){console.error("Failed to fetch services",n)}},O=async()=>{try{await fetch(`/no-show-serving/${a==null?void 0:a.id}`),w(0),y(null),N(!1),v(0)}catch(s){console.error("Failed to fetch services",s)}},Q=async()=>{if(!$()){o(!0),h("Calling Next");try{const n=await(await fetch("/next-token")).json();if(n!=null&&n.id){m(n),y(Date.now()),N(!0);const j=await(await fetch(`/start-serving/${n.id}`)).json();console.log("Started serving:",j),P(n)}else console.warn("No next token received.")}catch(s){console.error("Failed to fetch services",s)}finally{let s;return s=setTimeout(()=>{o(!1),h("Next")},1e3),()=>clearTimeout(s)}}};r.useEffect(()=>{const s=setInterval(()=>{E()},1e4);return()=>clearInterval(s)},[]),r.useEffect(()=>{let s;return p&&u!==null?s=setInterval(()=>{const n=Date.now(),b=Math.floor((n-u)/1e3);v(k+b)},1e3):v(k),()=>clearInterval(s)},[p,u,k]);const S=s=>{const n=String(Math.floor(s/3600)).padStart(2,"0"),b=String(Math.floor(s%3600/60)).padStart(2,"0"),j=String(s%60).padStart(2,"0");return`${n}:${b}:${j}`},W=async()=>{try{const n=await(await fetch("/is-previous-token")).json();console.log("isPreviousTokenExist:",n),L(n)}catch(s){console.error("Failed to check previous token:",s),L(!1)}};return r.useEffect(()=>{E(),W()},[]),e.jsxs("div",{className:"flex h-full w-full px-15 text-gray-800 dark:bg-gray-900 dark:text-gray-900",children:[e.jsxs("div",{className:"flex w-1/2 flex-col justify-center",children:[e.jsx("div",{children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("h2",{className:"mb-2 text-lg font-medium text-orange-600 dark:text-orange-400",children:"Current Serving"}),e.jsx("h1",{className:"mb-4 text-2xl font-bold text-blue-900 dark:text-blue-300",children:"Token Number"}),e.jsx("div",{className:"w-fit rounded-xl border-2 border-orange-500 px-12 py-6 text-[64px] font-bold text-orange-600 dark:border-orange-400 dark:text-orange-400",children:(a==null?void 0:a.token_number_display)??"---"}),e.jsxs("div",{className:"mt-6 text-center",children:[e.jsx("p",{className:"mb-1 text-sm text-gray-500 dark:text-gray-400",children:"Serving Time"}),e.jsxs("p",{className:"text-3xl font-bold text-blue-900 dark:text-blue-300",children:[" ",S(R)]})]})]})}),e.jsxs("div",{className:"mt-8 flex justify-between text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"mb-1 text-lg font-medium text-gray-500 dark:text-gray-400",children:"Total Served Tokens"}),e.jsx("p",{className:"text-xl font-bold text-blue-900 dark:text-blue-300",children:i==null?void 0:i.served})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-1 text-lg font-medium text-gray-500 dark:text-gray-400",children:"Total Pending"}),e.jsx("p",{className:"text-xl font-bold text-orange-600 dark:text-orange-400",children:i==null?void 0:i.pending})]})]})]}),e.jsx("div",{className:"mx-4 w-px bg-gray-300 dark:bg-gray-600"}),e.jsxs("div",{className:"flex h-full w-1/2 flex-col justify-center px-15",children:[e.jsxs("div",{className:"mb-10 flex flex-wrap gap-6 lg:flex-nowrap",children:[e.jsxs("div",{className:"w-full rounded-xl p-6 lg:w-3/2",children:[e.jsx("h2",{className:"mb-4 text-xl font-semibold text-blue-900 dark:text-blue-300",children:"Profile Info"}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-700 dark:text-gray-300",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-500 dark:text-gray-400",children:"Name:"})," ",D.name]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-500 dark:text-gray-400",children:"Email:"})," ",D.email]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-medium text-gray-500 dark:text-gray-400",children:"Service:"}),e.jsx("div",{children:e.jsx(ge,{})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-medium text-gray-500 dark:text-gray-400",children:"Counter:"}),e.jsx(me,{})]})]})]}),e.jsxs("div",{className:"w-full rounded-xl p-6 lg:w-1/3",children:[e.jsx("h2",{className:"mb-4 text-xl font-semibold text-blue-900 dark:text-blue-300",children:"Performance"}),e.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:e.jsx("span",{className:"font-medium text-orange-600 dark:text-orange-400",children:e.jsx("b",{children:A})})})]})]}),e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx(f,{onClick:Q,className:"w-1/2 rounded-lg bg-indigo-500 p-6 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:g}),e.jsx(f,{onClick:K,className:"w-1/2 rounded-lg bg-indigo-500 p-6 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:"End"}),e.jsx(f,{onClick:O,className:"w-1/2 rounded-lg bg-indigo-500 p-6 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:"No Show"}),e.jsx(f,{onClick:I,className:"w-1/2 rounded-lg bg-indigo-500 p-6 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:t}),e.jsx(he,{title:"Call Manual",endpoint:"call_manual"}),e.jsx(f,{onClick:G,className:"w-1/2 rounded-lg bg-indigo-500 p-6 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:p?"Resume":"Pause"})]})]})]})};function be(){const[l,i]=r.useState([]),[c,a]=r.useState({current_page:1,last_page:1,total:0}),[m,x]=r.useState(!0),o=async(g=1)=>{try{x(!0);const t=await(await fetch(`/login-logs?page=${g}`)).json();i(t.data),a({current_page:t.current_page,last_page:t.last_page,total:t.total})}catch(h){console.error("Failed to fetch login logs",h)}finally{x(!1)}};return r.useEffect(()=>{o()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4 font-bold",children:"Login History"}),e.jsxs(ae,{children:[e.jsx(re,{children:e.jsxs(_,{children:[e.jsx(F,{children:"Date"}),e.jsx(F,{children:"IP Address"})]})}),e.jsx(ne,{children:l.length?l.map((g,h)=>e.jsxs(_,{children:[e.jsx(T,{children:g.formatted_logged_in_at}),e.jsx(T,{children:g.ip_address})]},h)):e.jsx(_,{children:e.jsx(T,{colSpan:3,className:"py-6 text-center",children:m?"Loading...":"No login records found."})})})]}),e.jsxs("div",{className:"mt-4 flex justify-between",children:[e.jsxs("div",{children:["Page ",c.current_page," of ",c.last_page]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx(f,{variant:"outline",disabled:c.current_page===1,onClick:()=>o(c.current_page-1),children:"Previous"}),e.jsx(f,{variant:"outline",disabled:c.current_page===c.last_page,onClick:()=>o(c.current_page+1),children:"Next"})]})]})]})}const fe=[{title:"Dashboard",href:"/dashboard"}];function De(){var g,h;const{auth:l}=M().props,i=[{title:"Total Visits Today",value:"320",icon:e.jsx(X,{className:"h-8 w-8 text-blue-500"})},{title:"Total in Queue",value:"22",icon:e.jsx(ce,{className:"h-8 w-8 text-yellow-500"})},{title:"VIP Customers",value:"8",icon:e.jsx(xe,{className:"h-8 w-8 text-purple-500"})},{title:"Avg. Wait Time",value:"5 min",icon:e.jsx(oe,{className:"h-8 w-8 text-green-500"})}],[c,a]=r.useState([]),m=async()=>{try{const d=await(await fetch("/tokens")).json();console.log("ðŸš€ ~ fetchTokenCounts ~ json:",d),a(d.data)}catch(t){console.error("Failed to fetch services",t)}};r.useEffect(()=>{m()},[]);const x=[{ticket:"V001",name:"Mr. Khan",counter:"1",status:"Serving"},{ticket:"V002",name:"Dr. Ayesha",counter:"VIP Lounge",status:"Waiting"}],o=[{name:"Counter A",ticket:"A101",status:"Serving"},{name:"Counter B",ticket:"B205",status:"Idle"},{name:"Counter C",ticket:"C309",status:"Serving"}];return e.jsxs(J,{breadcrumbs:fe,children:[e.jsx(z,{title:"Queue Management Dashboard"}),((g=l==null?void 0:l.user)==null?void 0:g.type)==="master"&&e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 p-4",children:[e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 xl:grid-cols-4",children:i.map((t,d)=>e.jsxs("div",{className:"flex items-center justify-between rounded-xl border p-4 shadow-sm dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:t.title}),e.jsx("p",{className:"mt-2 text-2xl font-semibold text-gray-900 dark:text-white",children:t.value})]}),e.jsx("div",{className:"ml-4",children:t.icon})]},d))}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"h-80 overflow-auto rounded-xl border border-gray-200 bg-[var(--background)] p-4 text-[var(--foreground)] dark:border-gray-700",children:[e.jsx("h3",{className:"mb-4 text-lg font-semibold text-gray-800 dark:text-white",children:"Regular Customers"}),e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 text-left dark:border-gray-700",children:[e.jsx("th",{className:"p-2 font-medium",children:"Ticket No."}),e.jsx("th",{className:"p-2 font-medium",children:"Counter"})]})}),e.jsx("tbody",{children:c.map((t,d)=>{var u;return e.jsxs("tr",{className:"border-t border-gray-200 dark:border-gray-700",children:[e.jsx("td",{className:"p-2 font-mono",children:t==null?void 0:t.token_number_display}),e.jsxs("td",{className:"p-2",children:["Counter ",(u=t==null?void 0:t.counter)==null?void 0:u.name]})]},d)})})]})]}),e.jsxs("div",{className:"h-80 overflow-auto rounded-xl border border-gray-200 bg-[var(--background)] p-4 text-[var(--foreground)] dark:border-gray-700",children:[e.jsx("h3",{className:"mb-4 text-lg font-semibold text-gray-800 dark:text-white",children:"VIP Customers"}),e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 text-left dark:border-gray-700",children:[e.jsx("th",{className:"p-2 font-medium",children:"Ticket No."}),e.jsx("th",{className:"p-2 font-medium",children:"Name"}),e.jsx("th",{className:"p-2 font-medium",children:"Counter"}),e.jsx("th",{className:"p-2 font-medium",children:"Status"})]})}),e.jsx("tbody",{children:x.map((t,d)=>e.jsxs("tr",{className:"border-t border-gray-200 dark:border-gray-700",children:[e.jsx("td",{className:"p-2 font-mono",children:t.ticket}),e.jsx("td",{className:"p-2",children:t.name}),e.jsx("td",{className:"p-2",children:t.counter}),e.jsx("td",{className:"p-2",children:e.jsx("span",{className:`inline-block rounded px-2 py-1 text-xs font-semibold ${t.status==="Serving"?"bg-green-100 text-green-800 dark:bg-green-800/30 dark:text-green-300":"bg-yellow-100 text-yellow-800 dark:bg-yellow-800/30 dark:text-yellow-300"}`,children:t.status})})]},d))})]})]}),e.jsxs("div",{className:"h-80 overflow-auto rounded-xl border border-gray-200 bg-[var(--background)] p-4 text-[var(--foreground)] dark:border-gray-700",children:[e.jsx("h3",{className:"mb-4 text-lg font-semibold text-gray-800 dark:text-white",children:"Counters"}),e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 text-left dark:border-gray-700",children:[e.jsx("th",{className:"p-2 font-medium",children:"Counter"}),e.jsx("th",{className:"p-2 font-medium",children:"Ticket No."}),e.jsx("th",{className:"p-2 font-medium",children:"Status"})]})}),e.jsx("tbody",{children:o.map((t,d)=>e.jsxs("tr",{className:"border-t border-gray-200 dark:border-gray-700",children:[e.jsx("td",{className:"p-2",children:t.name}),e.jsx("td",{className:"p-2 font-mono",children:t.ticket}),e.jsx("td",{className:"p-2",children:e.jsx("span",{className:`inline-block rounded px-2 py-1 text-xs font-semibold ${t.status==="Serving"?"bg-green-100 text-green-800 dark:bg-green-800/30 dark:text-green-300":"bg-yellow-100 text-yellow-800 dark:bg-yellow-800/30 dark:text-yellow-300"}`,children:t.status})})]},d))})]})]}),e.jsxs("div",{className:"h-80 overflow-auto rounded-xl border border-gray-200 bg-[var(--background)] p-4 text-[var(--foreground)] dark:border-gray-700",children:[e.jsx("h3",{className:"mb-4 text-lg font-semibold text-gray-800 dark:text-white",children:"Counters"}),e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 text-left dark:border-gray-700",children:[e.jsx("th",{className:"p-2 font-medium",children:"Counter"}),e.jsx("th",{className:"p-2 font-medium",children:"Ticket No."}),e.jsx("th",{className:"p-2 font-medium",children:"Status"})]})}),e.jsx("tbody",{children:o.map((t,d)=>e.jsxs("tr",{className:"border-t border-gray-200 dark:border-gray-700",children:[e.jsx("td",{className:"p-2",children:t.name}),e.jsx("td",{className:"p-2 font-mono",children:t.ticket}),e.jsx("td",{className:"p-2",children:e.jsx("span",{className:`inline-block rounded px-2 py-1 text-xs font-semibold ${t.status==="Serving"?"bg-green-100 text-green-800 dark:bg-green-800/30 dark:text-green-300":"bg-yellow-100 text-yellow-800 dark:bg-yellow-800/30 dark:text-yellow-300"}`,children:t.status})})]},d))})]})]}),e.jsx("div",{className:"w-full rounded-lg border border-gray-100 bg-[var(--background)] p-4 p-6 text-[var(--foreground)] shadow dark:border-gray-700 dark:bg-gray-900",children:e.jsx(be,{})})]})]}),((h=l==null?void 0:l.user)==null?void 0:h.type)==="user"&&e.jsx(ue,{})]})}export{De as default};
