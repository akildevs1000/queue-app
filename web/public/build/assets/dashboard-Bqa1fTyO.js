import{r as n,j as e,K as A,L as q}from"./app-Dt_0lK2L.js";import{A as z,U as G}from"./app-layout-7ZLmkLoT.js";import{B as y}from"./button-hS_V_gx-.js";import{T as X,a as Y,b as E,c as R,d as Z,e as P}from"./table-B9eMVvFR.js";import{c as $}from"./app-logo-icon-DitkmmnH.js";import"./utils-jAU0Cazi.js";import"./index-B5QTDXBA.js";import"./index-CL1UTqbg.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],ee=$("Activity",I);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],se=$("Clock",te);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]],ae=$("UserCheck",re);function ne(){const[l,i]=n.useState(null),[c,a]=n.useState(!0),g=async()=>{try{a(!0);const o=await(await fetch("/counter-by-user")).json();console.log("🚀 ~ fetchLastLogin ~ json:",o),i(o)}catch(m){console.error("Failed to fetch last login",m)}finally{a(!1)}};return n.useEffect(()=>{g()},[]),e.jsx("div",{className:"",children:c?e.jsx("p",{className:"text-gray-500",children:"Loading..."}):l?e.jsx("div",{className:"space-y-2 text-sm",children:e.jsxs("p",{children:[" ",l.name]})}):e.jsx("p",{className:"text-gray-500",children:"---"})})}function le(){const[l,i]=n.useState(null),[c,a]=n.useState(!0),g=async()=>{try{a(!0);const o=await(await fetch("/service-by-user")).json();console.log("🚀 ~ fetchLastLogin ~ json:",o),i(o)}catch(m){console.error("Failed to fetch last login",m)}finally{a(!1)}};return n.useEffect(()=>{g()},[]),e.jsx("div",{className:"",children:c?e.jsx("p",{className:"text-gray-500",children:"Loading..."}):l?e.jsx("div",{className:"space-y-2 text-sm",children:e.jsxs("p",{children:[" ",l.name]})}):e.jsx("p",{className:"text-gray-500",children:"No login record found."})})}const oe=()=>{const{auth:l}=A().props,[i,c]=n.useState(null),[a,g]=n.useState(null),[m,o]=n.useState(!1),[f,h]=n.useState("Next"),[t,d]=n.useState("Recall"),[u,p]=n.useState(null),[F,ie]=n.useState(null),[j,k]=n.useState(!1),[w,T]=n.useState(0),[M,S]=n.useState(0),[b,O]=n.useState(null),N=n.useRef(null),D=l.user||{name:"John Doe",email:"john@example.com"},W=async()=>{try{const r=await(await fetch("/token-counts")).json();c(r)}catch(s){console.error("Failed to fetch services",s)}},B=async()=>{if(!(a!=null&&a.token_number_display))return;d(`Recalling ${a==null?void 0:a.token_number_display}`),o(!0);const s=N.current;s&&s.readyState===WebSocket.OPEN?(console.log("🚀 ~ reCall ~ announcerPayload:",b),s.send(JSON.stringify(b))):console.warn("WebSocket is not open.");let r;return r=setTimeout(()=>{o(!1),d("Recall")},5e3),()=>clearTimeout(r)},J=()=>{if(j&&u!==null){const s=Date.now(),r=Math.floor((s-u)/1e3);T(x=>x+r),p(null),k(!1)}},U=()=>{!j&&a&&(p(Date.now()),k(!0))},V=()=>{j?J():U()},H=async()=>{if(!(a!=null&&a.token_number_display))return;let s=w;if(j&&u!==null){const r=Date.now();s+=Math.floor((r-u)/1e3)}console.log("Total time served:",_(s));try{if(await fetch(`/end-serving/${a==null?void 0:a.id}?total_serving_time_display=${_(s)}`),T(0),p(null),k(!1),S(0),g(null),!(b!=null&&b.data))return;const r=N.current;if((r==null?void 0:r.readyState)===WebSocket.OPEN){const x={event:"token-serving-end",data:b.data};console.log("🚀 Sending token-serving-end event:",x),r.send(JSON.stringify(x))}else console.warn("⚠️ WebSocket is not open.")}catch(r){console.error("Failed to fetch services",r)}},K=async()=>{if(!(b!=null&&b.data))return;const s=N.current;if((s==null?void 0:s.readyState)===WebSocket.OPEN){const r={event:"token-serving-end",data:b.data};console.log("🚀 Sending token-serving-end event:",r),s.send(JSON.stringify(r))}else console.warn("⚠️ WebSocket is not open.");try{await fetch(`/no-show-serving/${a==null?void 0:a.id}`),T(0),p(null),k(!1),S(0),g(null)}catch(r){console.error("Failed to fetch services",r)}},Q=async()=>{if(!(a!=null&&a.token_number_display)){o(!0),h("Calling Next");try{let r=await(await fetch("/next-token")).json();if(!(r!=null&&r.id))return;g(r),p(Date.now()),k(!0);const v=await(await fetch(`/start-serving/${r.id}`)).json();if(v&&v.counter){const C=N.current;if(C&&C.readyState===WebSocket.OPEN){const L={event:"token-serving",data:v};console.log("🚀 ~ nextToken ~ socketPacket:",L),O(L),C.send(JSON.stringify(L))}else console.warn("WebSocket is not open.")}}catch(s){console.error("Failed to fetch services",s)}finally{let s;return s=setTimeout(()=>{o(!1),h("Next")},1e3),()=>clearTimeout(s)}}},_=s=>{const r=String(Math.floor(s/3600)).padStart(2,"0"),x=String(Math.floor(s%3600/60)).padStart(2,"0"),v=String(s%60).padStart(2,"0");return`${r}:${x}:${v}`};return n.useEffect(()=>{W();const s=new WebSocket("ws://192.168.2.6:8080");return N.current=s,s.addEventListener("open",()=>{console.log("Connected to WS server")}),s.addEventListener("message",r=>{try{const x=JSON.parse(r.data);x.event==="new-ticket"?(console.log("Received new-ticket event:",x),W()):console.log("Received other event:",x)}catch{console.error("Failed to parse message:",r.data)}}),s.addEventListener("error",r=>{console.error("WebSocket error:",r)}),()=>{s.close()}},[]),n.useEffect(()=>{let s;return j&&u!==null?s=setInterval(()=>{const r=Date.now(),x=Math.floor((r-u)/1e3);S(w+x)},1e3):S(w),()=>clearInterval(s)},[j,u,w]),e.jsxs("div",{className:"flex h-full w-full px-15 text-gray-800 dark:bg-gray-900 dark:text-gray-900",children:[e.jsxs("div",{className:"flex w-1/2 flex-col justify-center",children:[e.jsx("div",{children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("h2",{className:"mb-2 text-lg font-medium text-orange-600 dark:text-orange-400",children:"Current Serving"}),e.jsx("h1",{className:"mb-4 text-2xl font-bold text-blue-900 dark:text-blue-300",children:"Token Number"}),e.jsx("div",{className:"w-fit rounded-xl border-2 border-orange-500 px-12 py-6 text-[64px] font-bold text-orange-600 dark:border-orange-400 dark:text-orange-400",children:(a==null?void 0:a.token_number_display)??"---"}),e.jsxs("div",{className:"mt-6 text-center",children:[e.jsx("p",{className:"mb-1 text-sm text-gray-500 dark:text-gray-400",children:"Serving Time"}),e.jsxs("p",{className:"text-3xl font-bold text-blue-900 dark:text-blue-300",children:[" ",_(M)]})]})]})}),e.jsxs("div",{className:"mt-8 flex justify-between text-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"mb-1 text-lg font-medium text-gray-500 dark:text-gray-400",children:"Total Served Tokens"}),e.jsx("p",{className:"text-xl font-bold text-blue-900 dark:text-blue-300",children:i==null?void 0:i.served})]}),e.jsxs("div",{children:[e.jsx("p",{className:"mb-1 text-lg font-medium text-gray-500 dark:text-gray-400",children:"Total Pending"}),e.jsx("p",{className:"text-xl font-bold text-orange-600 dark:text-orange-400",children:i==null?void 0:i.pending})]})]})]}),e.jsx("div",{className:"mx-4 w-px bg-gray-300 dark:bg-gray-600"}),e.jsxs("div",{className:"flex h-full w-1/2 flex-col justify-center px-15",children:[e.jsxs("div",{className:"mb-10 flex flex-wrap gap-6 lg:flex-nowrap",children:[e.jsxs("div",{className:"w-full rounded-xl p-6 lg:w-3/2",children:[e.jsx("h2",{className:"mb-4 text-xl font-semibold text-blue-900 dark:text-blue-300",children:"Profile Info"}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-700 dark:text-gray-300",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-500 dark:text-gray-400",children:"Name:"})," ",D.name]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium text-gray-500 dark:text-gray-400",children:"Email:"})," ",D.email]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-medium text-gray-500 dark:text-gray-400",children:"Service:"}),e.jsx("div",{children:e.jsx(le,{})})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-medium text-gray-500 dark:text-gray-400",children:"Counter:"}),e.jsx(ne,{})]})]})]}),e.jsxs("div",{className:"w-full rounded-xl p-6 lg:w-1/3",children:[e.jsx("h2",{className:"mb-4 text-xl font-semibold text-blue-900 dark:text-blue-300",children:"Performance"}),e.jsx("div",{className:"text-sm text-gray-700 dark:text-gray-300",children:e.jsx("span",{className:"font-medium text-orange-600 dark:text-orange-400",children:e.jsx("b",{children:F})})})]})]}),e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx(y,{onClick:Q,className:"w-1/2 rounded-lg bg-indigo-500 p-6 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:f}),e.jsx(y,{onClick:H,className:"w-1/2 rounded-lg bg-indigo-500 p-6 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:"End"}),e.jsx(y,{onClick:K,className:"w-1/2 rounded-lg bg-indigo-500 p-6 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:"No Show"}),e.jsx(y,{onClick:B,className:"w-1/2 rounded-lg bg-indigo-500 p-6 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:t}),e.jsx(y,{onClick:V,className:"w-1/2 rounded-lg bg-indigo-500 p-6 font-semibold text-white transition hover:bg-indigo-700 dark:border-gray-600 dark:bg-gray-800",children:j?"Resume":"Pause"})]})]})]})};function ce(){const[l,i]=n.useState([]),[c,a]=n.useState({current_page:1,last_page:1,total:0}),[g,m]=n.useState(!0),o=async(f=1)=>{try{m(!0);const t=await(await fetch(`/login-logs?page=${f}`)).json();i(t.data),a({current_page:t.current_page,last_page:t.last_page,total:t.total})}catch(h){console.error("Failed to fetch login logs",h)}finally{m(!1)}};return n.useEffect(()=>{o()},[]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4 font-bold",children:"Login History"}),e.jsxs(X,{children:[e.jsx(Y,{children:e.jsxs(E,{children:[e.jsx(R,{children:"Date"}),e.jsx(R,{children:"IP Address"})]})}),e.jsx(Z,{children:l.length?l.map((f,h)=>e.jsxs(E,{children:[e.jsx(P,{children:f.formatted_logged_in_at}),e.jsx(P,{children:f.ip_address})]},h)):e.jsx(E,{children:e.jsx(P,{colSpan:3,className:"py-6 text-center",children:g?"Loading...":"No login records found."})})})]}),e.jsxs("div",{className:"mt-4 flex justify-between",children:[e.jsxs("div",{children:["Page ",c.current_page," of ",c.last_page]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx(y,{variant:"outline",disabled:c.current_page===1,onClick:()=>o(c.current_page-1),children:"Previous"}),e.jsx(y,{variant:"outline",disabled:c.current_page===c.last_page,onClick:()=>o(c.current_page+1),children:"Next"})]})]})]})}const de=[{title:"Dashboard",href:"/dashboard"}];function ye(){var f,h;const{auth:l}=A().props,i=[{title:"Total Visits Today",value:"320",icon:e.jsx(G,{className:"h-8 w-8 text-blue-500"})},{title:"Total in Queue",value:"22",icon:e.jsx(se,{className:"h-8 w-8 text-yellow-500"})},{title:"VIP Customers",value:"8",icon:e.jsx(ae,{className:"h-8 w-8 text-purple-500"})},{title:"Avg. Wait Time",value:"5 min",icon:e.jsx(ee,{className:"h-8 w-8 text-green-500"})}],[c,a]=n.useState([]),g=async()=>{try{const d=await(await fetch("/tokens")).json();console.log("🚀 ~ fetchTokenCounts ~ json:",d),a(d.data)}catch(t){console.error("Failed to fetch services",t)}};n.useEffect(()=>{g()},[]);const m=[{ticket:"V001",name:"Mr. Khan",counter:"1",status:"Serving"},{ticket:"V002",name:"Dr. Ayesha",counter:"VIP Lounge",status:"Waiting"}],o=[{name:"Counter A",ticket:"A101",status:"Serving"},{name:"Counter B",ticket:"B205",status:"Idle"},{name:"Counter C",ticket:"C309",status:"Serving"}];return e.jsxs(z,{breadcrumbs:de,children:[e.jsx(q,{title:"Queue Management Dashboard"}),((f=l==null?void 0:l.user)==null?void 0:f.type)==="master"&&e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 p-4",children:[e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 xl:grid-cols-4",children:i.map((t,d)=>e.jsxs("div",{className:"flex items-center justify-between rounded-xl border p-4 shadow-sm dark:border-gray-700",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:t.title}),e.jsx("p",{className:"mt-2 text-2xl font-semibold text-gray-900 dark:text-white",children:t.value})]}),e.jsx("div",{className:"ml-4",children:t.icon})]},d))}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"h-80 overflow-auto rounded-xl border border-gray-200 bg-[var(--background)] p-4 text-[var(--foreground)] dark:border-gray-700",children:[e.jsx("h3",{className:"mb-4 text-lg font-semibold text-gray-800 dark:text-white",children:"Regular Customers"}),e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 text-left dark:border-gray-700",children:[e.jsx("th",{className:"p-2 font-medium",children:"Ticket No."}),e.jsx("th",{className:"p-2 font-medium",children:"Counter"})]})}),e.jsx("tbody",{children:c.map((t,d)=>{var u;return e.jsxs("tr",{className:"border-t border-gray-200 dark:border-gray-700",children:[e.jsx("td",{className:"p-2 font-mono",children:t==null?void 0:t.token_number_display}),e.jsxs("td",{className:"p-2",children:["Counter ",(u=t==null?void 0:t.counter)==null?void 0:u.name]})]},d)})})]})]}),e.jsxs("div",{className:"h-80 overflow-auto rounded-xl border border-gray-200 bg-[var(--background)] p-4 text-[var(--foreground)] dark:border-gray-700",children:[e.jsx("h3",{className:"mb-4 text-lg font-semibold text-gray-800 dark:text-white",children:"VIP Customers"}),e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 text-left dark:border-gray-700",children:[e.jsx("th",{className:"p-2 font-medium",children:"Ticket No."}),e.jsx("th",{className:"p-2 font-medium",children:"Name"}),e.jsx("th",{className:"p-2 font-medium",children:"Counter"}),e.jsx("th",{className:"p-2 font-medium",children:"Status"})]})}),e.jsx("tbody",{children:m.map((t,d)=>e.jsxs("tr",{className:"border-t border-gray-200 dark:border-gray-700",children:[e.jsx("td",{className:"p-2 font-mono",children:t.ticket}),e.jsx("td",{className:"p-2",children:t.name}),e.jsx("td",{className:"p-2",children:t.counter}),e.jsx("td",{className:"p-2",children:e.jsx("span",{className:`inline-block rounded px-2 py-1 text-xs font-semibold ${t.status==="Serving"?"bg-green-100 text-green-800 dark:bg-green-800/30 dark:text-green-300":"bg-yellow-100 text-yellow-800 dark:bg-yellow-800/30 dark:text-yellow-300"}`,children:t.status})})]},d))})]})]}),e.jsxs("div",{className:"h-80 overflow-auto rounded-xl border border-gray-200 bg-[var(--background)] p-4 text-[var(--foreground)] dark:border-gray-700",children:[e.jsx("h3",{className:"mb-4 text-lg font-semibold text-gray-800 dark:text-white",children:"Counters"}),e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 text-left dark:border-gray-700",children:[e.jsx("th",{className:"p-2 font-medium",children:"Counter"}),e.jsx("th",{className:"p-2 font-medium",children:"Ticket No."}),e.jsx("th",{className:"p-2 font-medium",children:"Status"})]})}),e.jsx("tbody",{children:o.map((t,d)=>e.jsxs("tr",{className:"border-t border-gray-200 dark:border-gray-700",children:[e.jsx("td",{className:"p-2",children:t.name}),e.jsx("td",{className:"p-2 font-mono",children:t.ticket}),e.jsx("td",{className:"p-2",children:e.jsx("span",{className:`inline-block rounded px-2 py-1 text-xs font-semibold ${t.status==="Serving"?"bg-green-100 text-green-800 dark:bg-green-800/30 dark:text-green-300":"bg-yellow-100 text-yellow-800 dark:bg-yellow-800/30 dark:text-yellow-300"}`,children:t.status})})]},d))})]})]}),e.jsxs("div",{className:"h-80 overflow-auto rounded-xl border border-gray-200 bg-[var(--background)] p-4 text-[var(--foreground)] dark:border-gray-700",children:[e.jsx("h3",{className:"mb-4 text-lg font-semibold text-gray-800 dark:text-white",children:"Counters"}),e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 text-left dark:border-gray-700",children:[e.jsx("th",{className:"p-2 font-medium",children:"Counter"}),e.jsx("th",{className:"p-2 font-medium",children:"Ticket No."}),e.jsx("th",{className:"p-2 font-medium",children:"Status"})]})}),e.jsx("tbody",{children:o.map((t,d)=>e.jsxs("tr",{className:"border-t border-gray-200 dark:border-gray-700",children:[e.jsx("td",{className:"p-2",children:t.name}),e.jsx("td",{className:"p-2 font-mono",children:t.ticket}),e.jsx("td",{className:"p-2",children:e.jsx("span",{className:`inline-block rounded px-2 py-1 text-xs font-semibold ${t.status==="Serving"?"bg-green-100 text-green-800 dark:bg-green-800/30 dark:text-green-300":"bg-yellow-100 text-yellow-800 dark:bg-yellow-800/30 dark:text-yellow-300"}`,children:t.status})})]},d))})]})]}),e.jsx("div",{className:"w-full rounded-lg border border-gray-100 bg-[var(--background)] p-4 p-6 text-[var(--foreground)] shadow dark:border-gray-700 dark:bg-gray-900",children:e.jsx(ce,{})})]})]}),((h=l==null?void 0:l.user)==null?void 0:h.type)==="user"&&e.jsx(oe,{})]})}export{ye as default};
