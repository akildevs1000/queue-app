import{K as C,r as g,m as k,j as e,L as F,S as L}from"./app-BbBR_rjP.js";import{S as M,H as E}from"./layout-DYkoGXfd.js";import{I as l}from"./input-error-BZ38b_sl.js";import{B as I}from"./button-CILUddA7.js";import{I as p}from"./input-C6W8WdIG.js";import{L as m}from"./label-CC1I5cS_.js";import{A as z}from"./app-layout-BHeFp7dM.js";import{S as A,a as T,b as W,c as D,f as h}from"./select-DqvmMSJC.js";import{z as R}from"./transition-CEfdTspy.js";import"./index-BVzhhSET.js";import"./utils-jAU0Cazi.js";import"./index-D90HfFci.js";import"./app-logo-icon-C3kL37nv.js";import"./index-DQHtUu_u.js";const B=[{title:"Tv Settings",href:"/settings/tv-settings"}];function ee({tv_settings:x}){const{auth:c}=C().props,[v,f]=g.useState(void 0),{data:t,setData:o,errors:d,processing:N,recentlySuccessful:S}=k({ip:c.user.ip,port:c.user.port,media_type:c.user.media_type||"image",media_url:[],media_height:c.user.media_height,media_width:c.user.media_width}),w=a=>{if(a.preventDefault(),v)return;const s=new FormData;s.append("ip",t.ip),s.append("port",t.port),s.append("media_type",t.media_type),s.append("media_height",t.media_height),s.append("media_width",t.media_width),t.media_url.forEach((i,r)=>{s.append(`media_url[${r}]`,i)}),L.post(route("tv_settings.update"),s,{forceFormData:!0,preserveScroll:!0,onSuccess:()=>{j()}})},u=g.useRef(null),j=()=>{if(!(t!=null&&t.ip)||!(t!=null&&t.port)){console.warn("Missing IP or port");return}const a=`ws://${t.ip}:${t.port}`,s=new WebSocket(a);u.current=s,s.addEventListener("open",()=>{console.log("âœ… Connected to WS server");const i=parseInt(t.media_height,10),r=parseInt(t.media_width,10);if(x){const n={event:"trigger-settings",data:{...x,media_height:isNaN(i)?0:i,media_width:isNaN(r)?0:r}};console.log("ðŸš€ ~ socket.addEventListener ~ payload:",n),s.send(JSON.stringify(n));return}const _={event:"trigger-settings",data:{media_height:isNaN(i)?0:i,media_width:isNaN(r)?0:r}};s.send(JSON.stringify(_))}),s.addEventListener("error",i=>{console.error("WebSocket error:",i)}),s.addEventListener("close",()=>{console.log("WebSocket connection closed")})},y=()=>{u.current&&(u.current.close(),u.current=null)};return g.useEffect(()=>(j(),()=>{y()}),[]),e.jsxs(z,{breadcrumbs:B,children:[e.jsx(F,{title:"TV settings"}),e.jsx(M,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(E,{title:"Update your tv settings",description:"update ip and port to connect to tv"}),e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"ip",children:"Ip Address"}),e.jsx(p,{id:"ip",className:"mt-1 block w-full",value:t.ip,onChange:a=>o("ip",a.target.value),required:!0,autoComplete:"ip",placeholder:"Ip Address"}),e.jsx(l,{className:"mt-2",message:d.ip})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"port",children:"Port"}),e.jsx(p,{id:"port",className:"mt-1 block w-full",value:t.port,onChange:a=>o("port",a.target.value),required:!0,autoComplete:"port",placeholder:"Port"}),e.jsx(l,{className:"mt-2",message:d.port})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"media_type",children:"Media Type"}),e.jsxs(A,{value:t.media_type,onValueChange:a=>o("media_type",a),children:[e.jsx(T,{className:"w-full",children:e.jsx(W,{placeholder:"Select media type"})}),e.jsxs(D,{children:[e.jsx(h,{value:"youtube",children:"YouTube"}),e.jsx(h,{value:"video",children:"Video"}),e.jsx(h,{value:"gif",children:"GIF"}),e.jsx(h,{value:"image",children:"Image (Multiple URLs)"})]})]}),e.jsx(l,{className:"mt-2",message:d.media_type})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"media_url",children:"Upload Media"}),e.jsx(p,{id:"media_url",type:"file",multiple:!0,className:"mt-1 block w-full",accept:"image/gif,image/jpeg,image/png,video/mp4",onChange:a=>{const s=Array.from(a.target.files??[]),i=2,r=i*1024*1024;if(s.filter(n=>n.size>r).length>0){f(`Some files exceed ${i}MB and were not selected.`);const n=s.filter(b=>b.size<=r);o("media_url",n)}else f(void 0),o("media_url",s)}}),e.jsx(l,{className:"mt-2",message:d.media_url}),e.jsx(l,{className:"mt-2",message:v??void 0})]}),t.media_url.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:t.media_url.map((a,s)=>{const i=URL.createObjectURL(a);return t.media_type==="image"||t.media_type==="gif"?e.jsx("img",{src:i,alt:`preview-${s}`,className:"h-24 w-24 rounded object-cover shadow"},s):t.media_type==="video"?e.jsx("video",{src:i,controls:!0,className:"h-24 w-32 rounded shadow"},s):null})}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"port",children:"Media Height"}),e.jsx(p,{id:"media_height",className:"mt-1 block w-full",value:t.media_height,onChange:a=>o("media_height",a.target.value),required:!0,autoComplete:"media_height",placeholder:"Media Height"}),e.jsx(l,{className:"mt-2",message:d.media_height})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"port",children:"Media Width"}),e.jsx(p,{id:"media_width",className:"mt-1 block w-full",value:t.media_width,onChange:a=>o("media_width",a.target.value),required:!0,autoComplete:"media_width",placeholder:"Media Width"}),e.jsx(l,{className:"mt-2",message:d.media_width})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(I,{disabled:N,children:"Save & Connect"}),e.jsx(R,{show:S,enter:"transition ease-in-out",enterFrom:"opacity-0",leave:"transition ease-in-out",leaveTo:"opacity-0",children:e.jsx("p",{className:"text-sm text-neutral-600",children:"Saved"})})]})]})]})})]})}export{ee as default};
