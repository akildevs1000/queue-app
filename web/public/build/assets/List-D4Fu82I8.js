import{r as s,j as e,L as Y}from"./app-DT_bFNg-.js";import{A as Z}from"./app-layout-BbX4zFCA.js";import{u as ee,S as u,g as x,h,i as p,j as b,k as f,l as m,T as ae,a as te,b as T,c as se,f as _,d as ne,e as F,o as re,p as le}from"./table-lvujSvyj.js";import{B as L}from"./button-BG6ECEqd.js";import"./utils-jAU0Cazi.js";import"./index-Bx05VgSP.js";import"./app-logo-icon-6Xi472RF.js";import"./index-CJW-n1bH.js";import"./index-Czn8XiSP.js";const ie=[{title:"Report",href:"/Report"}],V=[{cell:({row:l})=>l.index+1,header:"#"},{accessorKey:"service.name",header:"Service",id:"serviceName"},{accessorKey:"token_number_display",header:"Token"},{accessorKey:"counter.name",header:"Counter",id:"counterName"},{accessorKey:"user.name",header:"User"},{accessorKey:"language",header:"Language"},{accessorKey:"status",header:"Status",cell:({getValue:l})=>{const o={0:"Pending",1:"Not Answered",2:"Serving",3:"Served"},S=l(),C=o[S]||"Unknown Status";let r="inline-block rounded px-2 py-1 text-xs font-semibold";switch(S){case"2":r+=" bg-green-100 text-green-800 dark:bg-green-800/30 dark:text-green-300";break;case"3":r+=" bg-blue-100 text-blue-800 dark:bg-blue-800/30 dark:text-blue-300";break;case"0":r+=" bg-yellow-100 text-yellow-800 dark:bg-yellow-800/30 dark:text-yellow-300";break;case"1":r+=" bg-red-100 text-red-800 dark:bg-red-800/30 dark:text-red-300";break;default:r+=" bg-gray-100 text-gray-800 dark:bg-gray-800/30 dark:text-gray-300";break}return e.jsx("span",{className:r,children:C})}},{accessorKey:"total_serving_time_display",header:"Serving Time",cell:({getValue:l})=>{const o=l();return o===null?"---":o}}];function fe({services:l}){const[o,S]=s.useState([]),[C,r]=s.useState([]),[A,I]=s.useState({}),[K,M]=s.useState({}),[y,z]=s.useState(null),[w,D]=s.useState(null),[c,E]=s.useState(null),[d,U]=s.useState(null),[v,B]=s.useState([]),[k,oe]=s.useState([{id:"-1",name:"All"},{id:"0",name:"Pending"},{id:"1",name:"Not Answered"},{id:"2",name:"Serving"},{id:"3",name:"Served"}]),[P,ce]=s.useState([{id:"en",name:"English"},{id:"ar",name:"Arabic"}]),[H,G]=s.useState([]),[g,N]=s.useState({pageIndex:0,pageSize:10}),[$,q]=s.useState(0),n=ee({data:H,columns:V,state:{sorting:o,columnFilters:C,columnVisibility:A,rowSelection:K,pagination:g},onSortingChange:S,onColumnFiltersChange:r,onColumnVisibilityChange:I,onRowSelectionChange:M,onPaginationChange:N,manualPagination:!0,pageCount:$,getCoreRowModel:le(),getPaginationRowModel:re()});s.useEffect(()=>{(async()=>{try{const t=g.pageIndex+1,R=g.pageSize,i=new URL("/get-report-data",window.location.origin);i.searchParams.append("page",t.toString()),i.searchParams.append("per_page",R.toString()),y!==null&&i.searchParams.append("service_id",y.toString()),w!==null&&i.searchParams.append("counter_id",w.toString()),c!=="-1"&&i.searchParams.append("status",(c==null?void 0:c.toString())||""),d!=="-1"&&i.searchParams.append("language",(d==null?void 0:d.toString())||"");const j=await(await fetch(i.toString())).json();G(j.data),q(j.last_page),j.current_page!==t&&N(X=>({...X,pageIndex:j.current_page-1}))}catch(t){console.error("Failed to fetch tokens:",t)}})()},[g.pageIndex,g.pageSize,y,w,c,d]);const J=async a=>{z(a);try{const R=await(await fetch(`/counter-list-by-service-id/${a}`)).json();B(R)}catch(t){console.error("Failed to fetch counters",t)}},O=a=>{D(a)},Q=a=>{E(a)},W=a=>{U(a)};return e.jsxs(Z,{breadcrumbs:ie,children:[e.jsx(Y,{title:"Report"}),e.jsx("div",{className:"flex w-full items-center justify-between rounded-lg p-5",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(u,{onValueChange:J,children:[e.jsx(x,{className:"w-[180px]",children:e.jsx(h,{placeholder:"Filter by Service"})}),e.jsx(p,{children:e.jsxs(b,{children:[e.jsx(f,{children:"Services"}),l.map(a=>e.jsx(m,{value:a.id,children:a.name},a.id))]})})]}),e.jsxs(u,{onValueChange:O,children:[e.jsx(x,{className:"w-[180px]",children:e.jsx(h,{placeholder:"Filter by Counter"})}),e.jsx(p,{children:e.jsxs(b,{children:[e.jsx(f,{children:"Counter"}),v==null?void 0:v.map(a=>e.jsx(m,{value:a.id,children:a.name},a.id))]})})]}),e.jsxs(u,{onValueChange:Q,children:[e.jsx(x,{className:"w-[180px]",children:e.jsx(h,{placeholder:"Filter by Status"})}),e.jsx(p,{children:e.jsxs(b,{children:[e.jsx(f,{children:"Status"}),k==null?void 0:k.map(a=>e.jsx(m,{value:a.id,children:a.name},a.id))]})})]}),e.jsxs(u,{onValueChange:W,children:[e.jsx(x,{className:"w-[180px]",children:e.jsx(h,{placeholder:"Filter by Language"})}),e.jsx(p,{children:e.jsxs(b,{children:[e.jsx(f,{children:"Language"}),P==null?void 0:P.map(a=>e.jsx(m,{value:a.id,children:a.name},a.id))]})})]})]})}),e.jsx("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:e.jsxs("div",{className:"gap-4 rounded-xl border border-gray-200 bg-[var(--background)] p-4 text-[var(--foreground)] dark:border-gray-700",children:[e.jsxs(ae,{children:[e.jsx(te,{children:n.getHeaderGroups().map(a=>e.jsx(T,{children:a.headers.map(t=>e.jsx(se,{children:t.isPlaceholder?null:_(t.column.columnDef.header,t.getContext())},t.id))},a.id))}),e.jsx(ne,{children:n.getRowModel().rows.length?n.getRowModel().rows.map(a=>e.jsx(T,{children:a.getVisibleCells().map(t=>e.jsx(F,{children:_(t.column.columnDef.cell,t.getContext())},t.id))},a.id)):e.jsx(T,{children:e.jsx(F,{colSpan:V.length,className:"h-24 text-center",children:"No results."})})})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:"Rows per page:"}),e.jsxs(u,{value:String(n.getState().pagination.pageSize),onValueChange:a=>{n.setPageSize(Number(a)),N(t=>({...t,pageIndex:0,pageSize:Number(a)}))},children:[e.jsx(x,{className:"w-[100px]",children:e.jsx(h,{})}),e.jsx(p,{children:[5,10,20,50,100].map(a=>e.jsx(m,{value:String(a),children:a},a))})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{variant:"outline",onClick:()=>n.previousPage(),disabled:!n.getCanPreviousPage(),children:"Previous"}),e.jsxs("span",{children:["Page ",n.getState().pagination.pageIndex+1," of ",n.getPageCount()]}),e.jsx(L,{variant:"outline",onClick:()=>n.nextPage(),disabled:!n.getCanNextPage(),children:"Next"})]})]})]})})]})}export{V as columns,fe as default};
