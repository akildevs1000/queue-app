import{K as b,r as g,m as C,j as e,L as F,S as M}from"./app-ByoHfh73.js";import{S as k,H as I}from"./layout-Cn5EtnbF.js";import{I as l}from"./input-error-DWUMGDom.js";import{B as L}from"./button-DpqwR6DL.js";import{I as c}from"./input-drb7Vu5m.js";import{L as n}from"./label-BxRqc2RV.js";import{A as E}from"./app-layout-Bl_HJlxV.js";import{S as z,a as A,b as T,c as W,f as u}from"./select-Cl-CudJ5.js";import{z as D}from"./transition-CYizpOeE.js";import"./index-Vv8aDAAa.js";import"./utils-jAU0Cazi.js";import"./index-BAY0N5PL.js";import"./app-logo-icon-CaaxUqCH.js";import"./index-D5v8ZFAg.js";const R=[{title:"Tv Settings",href:"/settings/tv-settings"}];function Z(){const{auth:m}=b().props,[x,j]=g.useState(void 0),{data:t,setData:r,errors:d,processing:_,recentlySuccessful:N}=C({ip:m.user.ip,port:m.user.port,media_type:m.user.media_type||"image",media_url:[],media_height:m.user.media_height,media_width:m.user.media_width}),S=a=>{if(a.preventDefault(),x)return;const s=new FormData;s.append("ip",t.ip),s.append("port",t.port),s.append("media_type",t.media_type),s.append("media_height",t.media_height),s.append("media_width",t.media_width),t.media_url.forEach((i,o)=>{s.append(`media_url[${o}]`,i)}),M.post(route("tv_settings.update"),s,{forceFormData:!0,preserveScroll:!0,onSuccess:()=>{v()}})},p=g.useRef(null),v=()=>{if(!(t!=null&&t.ip)||!(t!=null&&t.port)){console.warn("Missing IP or port");return}const a=`ws://${t.ip}:${t.port}`,s=new WebSocket(a);p.current=s,s.addEventListener("open",()=>{console.log("âœ… Connected to WS server");const i=parseInt(t.media_height,10),o=parseInt(t.media_width,10),f={event:"trigger-settings",data:{...t,media_height:isNaN(i)?0:i,media_width:isNaN(o)?0:o,media_url:t.media_url}};s.send(JSON.stringify(f))}),s.addEventListener("error",i=>{console.error("WebSocket error:",i)}),s.addEventListener("close",()=>{console.log("WebSocket connection closed")})},w=()=>{p.current&&(p.current.close(),p.current=null)};return g.useEffect(()=>(v(),()=>{w()}),[]),e.jsxs(E,{breadcrumbs:R,children:[e.jsx(F,{title:"TV settings"}),e.jsx(k,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(I,{title:"Update your tv settings",description:"update ip and port to connect to tv"}),e.jsxs("form",{onSubmit:S,className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"ip",children:"Ip Address"}),e.jsx(c,{id:"ip",className:"mt-1 block w-full",value:t.ip,onChange:a=>r("ip",a.target.value),required:!0,autoComplete:"ip",placeholder:"Ip Address"}),e.jsx(l,{className:"mt-2",message:d.ip})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"port",children:"Port"}),e.jsx(c,{id:"port",className:"mt-1 block w-full",value:t.port,onChange:a=>r("port",a.target.value),required:!0,autoComplete:"port",placeholder:"Port"}),e.jsx(l,{className:"mt-2",message:d.port})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"media_type",children:"Media Type"}),e.jsxs(z,{value:t.media_type,onValueChange:a=>r("media_type",a),children:[e.jsx(A,{className:"w-full",children:e.jsx(T,{placeholder:"Select media type"})}),e.jsxs(W,{children:[e.jsx(u,{value:"youtube",children:"YouTube"}),e.jsx(u,{value:"video",children:"Video"}),e.jsx(u,{value:"gif",children:"GIF"}),e.jsx(u,{value:"image",children:"Image (Multiple URLs)"})]})]}),e.jsx(l,{className:"mt-2",message:d.media_type})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"media_url",children:"Upload Media"}),e.jsx(c,{id:"media_url",type:"file",multiple:!0,className:"mt-1 block w-full",accept:"image/gif,image/jpeg,image/png,video/mp4",onChange:a=>{const s=Array.from(a.target.files??[]),i=2,o=i*1024*1024;if(s.filter(h=>h.size>o).length>0){j(`Some files exceed ${i}MB and were not selected.`);const h=s.filter(y=>y.size<=o);r("media_url",h)}else j(void 0),r("media_url",s)}}),e.jsx(l,{className:"mt-2",message:d.media_url}),e.jsx(l,{className:"mt-2",message:x??void 0})]}),t.media_url.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:t.media_url.map((a,s)=>{const i=URL.createObjectURL(a);return t.media_type==="image"||t.media_type==="gif"?e.jsx("img",{src:i,alt:`preview-${s}`,className:"h-24 w-24 rounded object-cover shadow"},s):t.media_type==="video"?e.jsx("video",{src:i,controls:!0,className:"h-24 w-32 rounded shadow"},s):null})}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"port",children:"Media Height"}),e.jsx(c,{id:"media_height",className:"mt-1 block w-full",value:t.media_height,onChange:a=>r("media_height",a.target.value),required:!0,autoComplete:"media_height",placeholder:"Media Height"}),e.jsx(l,{className:"mt-2",message:d.media_height})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(n,{htmlFor:"port",children:"Media Width"}),e.jsx(c,{id:"media_width",className:"mt-1 block w-full",value:t.media_width,onChange:a=>r("media_width",a.target.value),required:!0,autoComplete:"media_width",placeholder:"Media Width"}),e.jsx(l,{className:"mt-2",message:d.media_width})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(L,{disabled:_,children:"Save & Connect"}),e.jsx(D,{show:N,enter:"transition ease-in-out",enterFrom:"opacity-0",leave:"transition ease-in-out",leaveTo:"opacity-0",children:e.jsx("p",{className:"text-sm text-neutral-600",children:"Saved"})})]})]})]})})]})}export{Z as default};
